<!DOCTYPE html>

<!--
    G√©n√©rateur d'Infographie Cybers√©curit√© v2.0
    Copyright (C) 2025 [Guillemin Pierre-Eric]
    
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published
    by the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
    GNU Affero General Public License for more details.
    
    You should have received a copy of the GNU Affero General Public License
    along with this program. If not, see <https://www.gnu.org/licenses/>.
    
    For commercial use, a separate license is required.
    Contact: [aaaa@bbb.ccc]
-->

<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur d'Infographie - Conduite √† tenir en cas de cyberattaque</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #003d82;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--light-color) 0%, #e9ecef 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* === LICENCE ET COPYRIGHT === */
        .license-info {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 11px;
            z-index: 10000;
            cursor: pointer;
            transition: var(--transition);
        }

        .license-info:hover {
            background: rgba(0,0,0,0.9);
            transform: scale(1.05);
        }

        .license-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 20000;
        }

        .license-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: var(--box-shadow);
        }

        /* === LAYOUT PRINCIPAL === */
		.app-container {
			display: flex;
			height: 100vh;
			overflow: hidden;
		}

		.editor-panel {
			width: 500px;
			height: 100vh;
			background: white;
			box-shadow: 2px 0 10px rgba(0,0,0,0.1);
			display: flex;
			flex-direction: column;
			position: relative;
			z-index: 1000;
		}

		.editor-header {
			background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
			color: white;
			padding: 20px;
			text-align: center;
			flex-shrink: 0;
		}

		.toolbar {
			background: #f8f9fa;
			padding: 15px 20px;
			border-bottom: 1px solid #dee2e6;
			display: flex;
			gap: 10px;
			flex-wrap: wrap;
			flex-shrink: 0;
		}

		.editor-content {
			flex: 1;
			overflow-y: auto;
			padding: 20px;
			padding-bottom: 40px;
		}

		.preview-panel {
			flex: 1;
			overflow-y: auto;
			background: var(--light-color);
			padding: 20px;
			height: 100vh;
		}

        /* === HEADER √âDITEUR === */
        .editor-header {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            color: white;
            padding: 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .editor-header h2 {
            margin-bottom: 5px;
            font-size: 1.4em;
        }

        .editor-header p {
            opacity: 0.9;
            font-size: 0.9em;
        }

        /* === BARRE D'OUTILS === */
        .toolbar {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            position: sticky;
            top: 80px;
            z-index: 99;
        }

        .toolbar-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .toolbar-btn {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            background: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .toolbar-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .toolbar-btn.active {
            background: var(--primary-color);
            color: white;
        }

        /* === CONTENU √âDITEUR === */
        .editor-content {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: var(--border-radius);
            font-size: 14px;
            transition: var(--transition);
            font-family: inherit;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* === SECTIONS === */
        .section-header {
            background: linear-gradient(135deg, var(--light-color), #e9ecef);
            padding: 15px;
            margin: 30px -20px 20px -20px;
            border-left: 4px solid var(--primary-color);
            font-weight: 700;
            color: #2c3e50;
            font-size: 1.1em;
            top: 135px;
            z-index: 98;
        }

        /* === PERSONNALISATION COULEURS === */
        .color-customization {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .color-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .color-input {
            width: 80px;
            height: 50px;
            border: 3px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: var(--transition);
        }

        .color-input:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .color-label {
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
            text-align: center;
            color: #495057;
        }

        .background-customization {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #dee2e6;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        /* === SAUVEGARDE ET CHARGEMENT === */
        .save-load-section {
            background: linear-gradient(135deg, #e8f5e8, #d4edda);
            border: 2px solid var(--success-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
        }

        .save-load-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        /* === √âDITEURS SP√âCIALIS√âS === */
        .step-editor {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #f8f9fa, white);
            transition: var(--transition);
        }

        .step-editor:hover {
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow);
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 15px;
        }
        
        .step-number-input {
            width: 60px !important;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }
        
        .step-icon-input {
            width: 80px !important;
            text-align: center;
            font-size: 20px;
            cursor: pointer;
        }

        .action-item-editor {
            border: 2px solid #dee2e6;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            transition: var(--transition);
        }

        .action-item-editor:hover {
            border-color: var(--primary-color);
            box-shadow: var(--box-shadow);
        }
        
        .action-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .text-editor-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        /* === S√âLECTEUR D'IC√îNES === */
        .icon-selector {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--primary-color);
            border-radius: 12px;
            padding: 15px;
            background: white;
            box-shadow: var(--box-shadow);
        }
        
        .icon-option {
            padding: 12px;
            text-align: center;
            cursor: pointer;
            border-radius: var(--border-radius);
            font-size: 24px;
            transition: var(--transition);
            background: var(--light-color);
        }
        
        .icon-option:hover {
            background: var(--primary-color);
            color: white;
            transform: scale(1.1);
        }
        
        .icon-option.selected {
            background: var(--primary-color);
            color: white;
        }

        /* === TIMELINE === */
        .timeline-editor {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #f8f9fa, white);
        }
        
        .timeline-item-editor {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        .timeline-item-input {
            flex: 1;
        }
        
        .timeline-separator-input {
            width: 80px;
            text-align: center;
        }

        /* === BOUTONS === */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 86, 179, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success-color), #1e7e34);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #c82333);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning-color), #e0a800);
            color: #212529;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info-color), #138496);
            color: white;
        }
        
        .btn-export {
            background: linear-gradient(135deg, var(--success-color), #20c997);
            color: white;
            padding: 18px 35px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 15px;
            width: 100%;
            margin-top: 30px;
            justify-content: center;
        }
        
        .btn-export:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(40, 167, 69, 0.4);
        }

        /* === TOOLTIPS === */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2c3e50;
            color: white;
            text-align: center;
            border-radius: var(--border-radius);
            padding: 10px;
            position: absolute;
            z-index: 10000;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            box-shadow: var(--box-shadow);
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #2c3e50 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
		
		/* === FAQ === */
        .faq-section {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .faq-header {
            background: linear-gradient(135deg, var(--light-color), #e9ecef);
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .faq-header:hover {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .faq-content {
            padding: 20px;
            display: none;
            line-height: 1.6;
        }
        
        .faq-content.active {
            display: block;
        }

        .faq-content ul, .faq-content ol {
            margin-left: 20px;
            margin-top: 10px;
        }

        .faq-content li {
            margin-bottom: 5px;
        }

        /* === LOGO === */
        .logo-editor {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            background: linear-gradient(135deg, #f8f9fa, white);
        }
        
        .logo-preview {
            max-width: 150px;
            max-height: 80px;
            margin: 15px 0;
            border: 2px solid #dee2e6;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        #drop-zone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-top: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        #drop-zone:hover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        #drop-zone.dragover {
            border-color: var(--primary-color);
            background-color: #f0f7ff;
        }

        /* === STYLES D'APER√áU === */
        .preview-container {
			max-width: 1200px;
			margin: 0 auto;
			/* Retirer le background: white; pour permettre la couleur personnalis√©e */
			border-radius: 20px;
			box-shadow: 0 20px 40px rgba(0,0,0,0.15);
			overflow: hidden;
			transition: var(--transition);
		}

        .preview-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0,0,0,0.2);
        }
        
        .preview-header {
            color: white;
            text-align: center;
            padding: 50px 30px;
            position: relative;
            background-attachment: fixed;
        }
        
        .preview-header::before {
            content: '‚ö†Ô∏è';
            font-size: 80px;
            display: block;
            margin-bottom: 25px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .preview-header h1 {
            font-size: 3em;
            font-weight: 900;
            margin-bottom: 15px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.4);
            letter-spacing: 2px;
        }
        
        .preview-header p {
            font-size: 1.3em;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .preview-header .logo,
		.preview-footer .logo {
			position: absolute;
			max-height: 100px;
			z-index: 10;
		}

		.preview-header .logo.top-left { left: 25px; top: 25px; }
		.preview-header .logo.top-right { right: 25px; top: 25px; }
		.preview-header .logo.top-center { 
			left: 50%; 
			top: 25px;
			transform: translateX(-50%); 
		}

		.preview-footer .logo.bottom-left { left: 25px; bottom: 25px; }
		.preview-footer .logo.bottom-right { right: 25px; bottom: 25px; }
		.preview-footer .logo.bottom-center { 
			left: 50%; 
			bottom: 25px;
			transform: translateX(-50%); 
		}
        
        .preview-timeline {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
            padding: 0 20px;
        }
        
        .preview-timeline-item {
            color: white;
            padding: 12px 25px;
            border-radius: 30px;
            margin: 8px;
            font-weight: 700;
            font-size: 1em;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: var(--transition);
        }

        .preview-timeline-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .preview-steps-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 35px;
            padding: 50px;
        }
        
        .preview-step {
            background: white;
            border-radius: 20px;
            padding: 35px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            border-left: 8px solid;
            position: relative;
            transition: var(--transition);
        }
        
        .preview-step:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 45px rgba(0,0,0,0.15);
        }
        
        .preview-step-number {
            position: absolute;
            top: -20px;
            left: 25px;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1.4em;
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .preview-step-icon {
            font-size: 4em;
            margin-bottom: 25px;
            display: block;
        }
        
        .preview-step h3 {
            font-size: 1.6em;
            margin-bottom: 20px;
            color: #2c3e50;
            font-weight: 800;
            line-height: 1.2;
        }
        
        .preview-step-content {
            color: #34495e;
            line-height: 1.7;
        }
        
        .preview-action-item {
            padding: 18px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 5px solid;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .preview-action-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }
        
        .preview-emergency-contact {
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 50px;
            text-align: center;
            font-size: 1.2em;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .preview-footer {
            color: white;
            text-align: center;
            padding: 40px 30px;
            position: relative;
            line-height: 1.6;
        }
        
        .preview-footer .logo {
            position: absolute;
            bottom: 25px;
            max-height: 80px;
        }
        
        .preview-footer .logo.bottom-left { left: 25px; }
        .preview-footer .logo.bottom-right { right: 25px; }
        .preview-footer .logo.bottom-center { 
            left: 50%; 
            transform: translateX(-50%); 
        }

		.preview-container {
			max-width: 1200px;
			margin: 0 auto;
			border-radius: 20px;
			box-shadow: 0 20px 40px rgba(0,0,0,0.15);
			overflow: hidden;
			transition: var(--transition);
		}

		.preview-timeline-item {
			color: white;
			padding: 12px 25px;
			border-radius: 30px;
			margin: 8px;
			font-weight: 700;
			font-size: 1em;
			box-shadow: 0 4px 15px rgba(0,0,0,0.2);
			transition: var(--transition);
			display: inline-block;
		}

        /* === TH√àMES === */
        .theme-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .theme-option.active {
            border-color: #000;
            transform: scale(1.1);
        }

        .theme-dark { background: linear-gradient(45deg, #2c3e50, #34495e); }
        .theme-blue { background: linear-gradient(45deg, #3498db, #2980b9); }
        .theme-green { background: linear-gradient(45deg, #27ae60, #229954); }
        .theme-red { background: linear-gradient(45deg, #e74c3c, #c0392b); }

        /* === NOTIFICATIONS === */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 10000;
            transform: translateX(400px);
            transition: var(--transition);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.info { background: var(--info-color); }

        /* === RESPONSIVE === */
        @media (max-width: 1400px) {
            .app-container {
                flex-direction: column;
            }
            
            .editor-panel {
                width: 100%;
                max-height: 500px;
            }
            
            .preview-steps-grid {
                grid-template-columns: 1fr;
                padding: 30px;
            }
        }

        @media (max-width: 768px) {
            .color-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .preview-header h1 {
                font-size: 2.2em;
            }
            
            .preview-emergency-contact {
                margin: 20px;
            }

            .toolbar {
                position: static;
            }

            .section-header {
                position: static;
            }
        }

        /* === ANIMATIONS === */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- Licence et Copyright -->
    <div class="license-info" onclick="showLicense()">
        üìÑ Licence AGPL-3.0
    </div>

    <!-- Modal de licence -->
	<div class="license-modal" id="licenseModal" onclick="hideLicense()">
		<div class="license-content" onclick="event.stopPropagation()">
	
		<h2 style="color: #2c3e50; margin-bottom: 20px;">üìÑ Licence AGPL-3.0</h2>
		
		<div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin-bottom: 20px; font-family: monospace; font-size: 12px;">
			<strong>G√©n√©rateur d'Infographie Cybers√©curit√© v2.0</strong><br>
			Copyright (C) 2025 [Guillemin Pierre-Eric]<br>
			Licence AGPL-3.0 + Licence Commerciale
		</div>
		
		<h3 style="color: #3498db; margin: 20px 0 10px 0;">üÜì Utilisation GRATUITE (AGPL-3.0) :</h3>
		<ul style="margin-left: 20px; line-height: 1.6;">
			<li><strong>Usage personnel</strong> - Libre et gratuit</li>
			<li><strong>Collectivit√©s locales</strong> - Mairies, conseils d√©partementaux/r√©gionaux</li>
			<li><strong>Services publics</strong> - Minist√®res, pr√©fectures, administrations</li>
			<li><strong>√âtablissements publics</strong> - H√¥pitaux, √©coles, universit√©s</li>
			<li><strong>Associations √† but non lucratif</strong> - Reconnues d'utilit√© publique</li>
		</ul>
		
		<div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
			<strong>‚öñÔ∏è Obligations AGPL-3.0 :</strong>
			<ul style="margin: 10px 0 0 20px;">
				<li>Publier le code source de toute modification</li>
				<li>Conserver les mentions de copyright</li>
				<li>Fournir le code source aux utilisateurs (m√™me en SaaS)</li>
				<li>Appliquer la m√™me licence aux travaux d√©riv√©s</li>
			</ul>
		</div>

		<h3 style="color: #e74c3c; margin: 20px 0 10px 0;">üíº Licence COMMERCIALE obligatoire :</h3>
		<ul style="margin-left: 20px; line-height: 1.6;">
			<li><strong>Entreprises priv√©es</strong> - SARL, SAS, SA, etc.</li>
			<li><strong>Consultants/Freelances</strong> - Pour usage client</li>
			<li><strong>Soci√©t√©s de conseil</strong> - Cybers√©curit√©, IT</li>
			<li><strong>Int√©gration commerciale</strong> - Dans produits/services payants</li>
		</ul>

		<h3 style="color: #f39c12; margin: 20px 0 10px 0;">üìú Conditions d'utilisation :</h3>
		<ul style="margin-left: 20px; line-height: 1.6;">
			<li>Le code source reste <strong>open source</strong> sous AGPL-3.0</li>
			<li>Modifications et am√©liorations encourag√©es</li>
			<li>Attribution de l'auteur original obligatoire</li>
			<li>AUCUNE GARANTIE sur le fonctionnement</li>
			<li>Utilisation √† vos risques et p√©rils</li>
		</ul>
		
		<div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0; border: 1px solid #ffeaa7;">
			<strong>‚ö†Ô∏è Avertissement :</strong> L'utilisation commerciale sans licence appropri√©e constitue une violation du droit d'auteur et peut entra√Æner des poursuites judiciaires.
		</div>
		
		<div style="text-align: center; margin-top: 20px;">
			<p><strong>Contact licence commerciale :</strong><br>
			üìß [pe.guillemin@mairie-tarbes]<br>
			üåê [A venir]</p>
		</div>

		<button class="btn btn-primary" onclick="hideLicense()" style="margin-top: 20px; width: 100%;">
			‚úÖ J'ai compris et j'accepte
		</button>
	</div>
	</div>
	<div class="app-container">
        <div class="editor-panel">
            <div class="editor-header">
                <h2>‚úèÔ∏è G√©n√©rateur d'Infographie</h2>
                <p>Cybers√©curit√© ‚Ä¢ Personnalisable ‚Ä¢ Open Source</p>
            </div>

            <!-- Barre d'outils -->
            <div class="toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="saveProject()" title="Sauvegarder le projet">
                        üíæ Sauvegarder
                    </button>
                    <button class="toolbar-btn" onclick="loadProject()" title="Charger un projet">
                        üìÅ Charger
                    </button>
                </div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" onclick="resetProject()" title="Nouveau projet">
                        üîÑ Reset
                    </button>
                    <button class="toolbar-btn" onclick="exportHTML()" title="Exporter en HTML">
                        üì• Export
                    </button>
					<button class="btn btn-warning" onclick="printOnSinglePage()" title="Imprimer en mode affiche (une seule page)">
						üìÑ Aper√ßu
					</button>
					<button class="btn btn-warning" onclick="printWithPreview()" title="Imprimer l'aper√ßu avec mise en page optimis√©e">
						üñ®Ô∏è Imprimer
					</button>
					<label for="print-format" style="font-size: 12px;">üìÑ Format</label>
						<select id="print-format" class="toolbar-btn">
							<option value="A4-portrait">A4 Portrait</option>
							<option value="A4-landscape" selected>A4 Paysage</option>
							<option value="A3-portrait">A3 Portrait</option>
							<option value="A3-landscape">A3 Paysage</option>
						</select>
                </div>
            </div>
            
            <div class="editor-content">
                <!-- Sauvegarde et chargement -->
                <div class="save-load-section">
                    <h3 style="margin-bottom: 15px; color: var(--success-color);">üíæ Gestion de projet</h3>
                    <div class="save-load-controls">
                        <input type="file" id="load-file" accept=".json" style="display: none;" onchange="handleLoadFile(event)">
                        <button class="btn btn-success" onclick="saveProjectToFile()">
                            üíæ T√©l√©charger projet
                        </button>
                        <button class="btn btn-info" onclick="document.getElementById('load-file').click()">
                            üìÅ Charger projet
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="project-name">Nom du projet</label>
                        <input type="text" id="project-name" value="Mon infographie cyberattaque" placeholder="Donnez un nom √† votre projet">
                    </div>
                </div>

                <!-- FAQ et Aide -->
                <div class="section-header">‚ùì Guide d'utilisation</div>
                
                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('faq1')">
                        <span><strong>üöÄ D√©marrage rapide</strong></span>
                        <span id="faq1-arrow">‚ñº</span>
                    </div>
                    <div id="faq1" class="faq-content">
                        <p><strong>Pour cr√©er votre infographie :</strong></p>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li><strong>Personnalisez les couleurs</strong> selon votre charte graphique</li>
                            <li><strong>Modifiez le texte</strong> (titre, sous-titre, message d'urgence)</li>
                            <li><strong>Ajustez les √©tapes</strong> selon vos proc√©dures internes</li>
                            <li><strong>Ajoutez votre logo</strong> pour personnaliser davantage</li>
                            <li><strong>Pr√©visualisez en temps r√©el</strong> vos modifications</li>
                            <li><strong>Exportez en HTML</strong> pour utilisation autonome</li>
                        </ol>
                    </div>
                </div>

                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('faq2')">
                        <span><strong>üé® Personnalisation des couleurs</strong></span>
                        <span id="faq2-arrow">‚ñº</span>
                    </div>
                    <div id="faq2" class="faq-content">
                        <p>Adaptez les couleurs √† votre organisation :</p>
                        <ul>
                            <li><strong>En-t√™te :</strong> Couleur principale de votre organisation</li>
                            <li><strong>Timeline :</strong> Couleur des √©tapes de progression</li>
                            <li><strong>Arri√®re-plans :</strong> Personnalisez le fond de chaque section</li>
                            <li><strong>Classifications :</strong> 4 niveaux de priorit√© personnalisables</li>
                            <li><strong>Th√®mes pr√©d√©finis :</strong> S√©lection rapide de palettes</li>
                        </ul>
                    </div>
                </div>

                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('faq3')">
                        <span><strong>üìù Gestion des √©tapes et actions</strong></span>
                        <span id="faq3-arrow">‚ñº</span>
                    </div>
                    <div id="faq3" class="faq-content">
                        <p>Organisation des proc√©dures :</p>
                        <ul>
                            <li><strong>√âtapes :</strong> Grandes phases de la proc√©dure (Imm√©diat, Alerte, etc.)</li>
                            <li><strong>Actions :</strong> T√¢ches sp√©cifiques dans chaque √©tape</li>
                            <li><strong>Ic√¥nes :</strong> Plus de 40 √©mojis pour illustrer visuellement</li>
                            <li><strong>Formatage :</strong> Gras, italique, soulignement, sauts de ligne</li>
                            <li><strong>Priorit√©s :</strong> 4 niveaux configurables (Critique, Important, Info, Succ√®s)</li>
                        </ul>
                    </div>
                </div>

                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('faq4')">
                        <span><strong>üñºÔ∏è Logos et branding</strong></span>
                        <span id="faq4-arrow">‚ñº</span>
                    </div>
                    <div id="faq4" class="faq-content">
                        <p>Int√©gration de votre identit√© visuelle :</p>
                        <ul>
                            <li><strong>Upload local :</strong> Glissez-d√©posez votre logo (PNG, JPG, SVG)</li>
                            <li><strong>URL externe :</strong> Lien vers un logo h√©berg√© en ligne</li>
                            <li><strong>6 positions :</strong> Haut/bas √ó gauche/centre/droite</li>
                            <li><strong>Redimensionnement :</strong> Taille ajustable de 50 √† 300px</li>
                            <li><strong>Export int√©gr√© :</strong> Logo converti en base64 dans le HTML final</li>
                        </ul>
                    </div>
                </div>

                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('faq5')">
                        <span><strong>üíæ Sauvegarde et export</strong></span>
                        <span id="faq5-arrow">‚ñº</span>
                    </div>
                    <div id="faq5" class="faq-content">
                        <p>Gestion des projets et exports :</p>
                        <ul>
                            <li><strong>Sauvegarde automatique :</strong> Dans le navigateur (localStorage)</li>
                            <li><strong>Export projet :</strong> Fichier JSON pour partage/backup</li>
                            <li><strong>Import projet :</strong> Rechargement d'un projet sauvegard√©</li>
                            <li><strong>Export HTML :</strong> Page autonome avec tout int√©gr√©</li>
                            <li><strong>Compatibilit√© :</strong> Fonctionne sur tous les navigateurs modernes</li>
                        </ul>
                    </div>
                </div>
				
				<!-- Personnalisation CSS avanc√©e -->
				<div class="section-header">üé® Personnalisation CSS avanc√©e</div>

				<div class="css-customization" style="background: #f8f9fa; border: 2px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 25px;">
					<div class="faq-section">
						<div class="faq-header" onclick="toggleFaq('css-help')">
							<span><strong>‚ÑπÔ∏è Guide de personnalisation CSS</strong></span>
							<span id="css-help-arrow">‚ñº</span>
						</div>
						<div id="css-help" class="faq-content">
							<p><strong>Options de personnalisation CSS :</strong></p>
							<ul>
								<li><strong>Pr√©fixe de classe :</strong> Ajoute un pr√©fixe unique √† toutes les classes CSS pour √©viter les conflits</li>
								<li><strong>Isolation CSS :</strong> Encapsule tous les styles dans un conteneur sp√©cifique</li>
								<li><strong>CSS personnalis√© :</strong> Ajoutez vos propres r√®gles CSS qui seront incluses dans l'export</li>
								<li><strong>Reset CSS :</strong> Optionnel, r√©initialise les styles de base</li>
							</ul>
							<p style="margin-top: 10px;"><strong>Exemple :</strong> Si vous utilisez le pr√©fixe "cyb-", la classe ".container" devient ".cyb-container"</p>
						</div>
					</div>

					<div class="form-group">
						<label for="css-prefix">Pr√©fixe de classe CSS (√©vite les conflits)</label>
						<input type="text" id="css-prefix" placeholder="Ex: cyb-, org-, custom-" value="" 
							   onchange="updateCssPrefix(this.value)">
					</div>

					<div class="form-group">
						<label for="css-container">Conteneur d'isolation CSS</label>
						<input type="text" id="css-container" placeholder="Ex: #cyberattack-infographic, .my-infographic" value="" 
							   onchange="updateCssContainer(this.value)">
					</div>

					<div class="form-group">
						<label>
							<input type="checkbox" id="css-reset" onchange="updateCssReset(this.checked)">
							Inclure un reset CSS minimal
						</label>
					</div>

					<div class="form-group">
						<label for="custom-css">CSS personnalis√© additionnel</label>
						<textarea id="custom-css" placeholder="/* Vos r√®gles CSS personnalis√©es */
				.ma-classe-custom {
					/* styles */
				}" style="min-height: 200px; font-family: 'Courier New', monospace; font-size: 13px;"
								  onchange="updateCustomCss(this.value)"></textarea>
					</div>

					<div class="form-group">
						<button class="btn btn-info" onclick="previewCssOutput()" style="width: 100%;">
							üëÅÔ∏è Pr√©visualiser le CSS g√©n√©r√©
						</button>
					</div>
				</div>

                <!-- Th√®mes pr√©d√©finis -->
                <div class="section-header">üé® Th√®mes pr√©d√©finis</div>
                
                <div class="color-customization">
                    <h3 style="margin-bottom: 15px;">S√©lection rapide</h3>
                    <div class="theme-selector">
                        <div class="theme-option theme-blue active" onclick="applyTheme('blue')" title="Th√®me Bleu Corporate"></div>
                        <div class="theme-option theme-red" onclick="applyTheme('red')" title="Th√®me Rouge Urgence"></div>
                        <div class="theme-option theme-green" onclick="applyTheme('green')" title="Th√®me Vert S√©curit√©"></div>
                        <div class="theme-option theme-dark" onclick="applyTheme('dark')" title="Th√®me Sombre Professionnel"></div>
                    </div>
                </div>

                <!-- Personnalisation des couleurs principales -->
                <div class="section-header">üé® Couleurs principales</div>
                
                <div class="color-customization">
                    <div class="color-grid">
                        <div class="color-input-group">
                            <input type="color" id="header-color" class="color-input" value="#dc3545" onchange="renderPreview(); autoSave();">
                            <label class="color-label">En-t√™te</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="timeline-color" class="color-input" value="#3498db" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Timeline</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="step-number-color" class="color-input" value="#0056b3" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Num√©ros √©tapes</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="footer-color" class="color-input" value="#2c3e50" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Pied de page</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="emergency-color" class="color-input" value="#ff6b6b" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Message urgence</label>
                        </div>
                    </div>
                </div>

                <!-- Personnalisation des arri√®re-plans -->
                <div class="section-header">üåà Arri√®re-plans</div>
                
                <div class="background-customization">
                    <div class="color-grid">
                        <div class="color-input-group">
                            <input type="color" id="body-bg-color" class="color-input" value="#f8f9fa" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Arri√®re-plan g√©n√©ral</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="content-bg-color" class="color-input" value="#ffffff" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Contenu principal</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="step-bg-color" class="color-input" value="#ffffff" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Cartes √©tapes</label>
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="preview-bg-color" class="color-input" value="#f8f9fa" onchange="renderPreview(); autoSave();">
                            <label class="color-label">Zone d'aper√ßu</label>
                        </div>
                    </div>
                </div>

                <!-- Classifications d'actions -->
                <div class="section-header">üè∑Ô∏è Classifications d'actions</div>
                
                <div class="faq-section">
                    <div class="faq-header" onclick="toggleFaq('classifications-help')">
                        <span><strong>‚ÑπÔ∏è Personnaliser les niveaux de priorit√©</strong></span>
                        <span id="classifications-help-arrow">‚ñº</span>
                    </div>
                    <div id="classifications-help" class="faq-content">
                        <p>Adaptez les classifications √† votre organisation :</p>
                        <ul>
                            <li><strong>Noms :</strong> Changez les libell√©s (ex: P1/P2/P3/P4, Urgent/Normal/Info)</li>
                            <li><strong>Couleurs :</strong> Associez des couleurs coh√©rentes avec votre charte</li>
                            <li><strong>Usage :</strong> Chaque action dans les √©tapes peut utiliser ces classifications</li>
                            <li><strong>Exemples :</strong> Critique=Rouge, Important=Orange, Info=Bleu, Succ√®s=Vert</li>
                        </ul>
                    </div>
                </div>
                
                <div class="color-customization">
                    <div class="color-grid">
                        <div class="color-input-group">
                            <input type="color" id="critical-color" class="color-input" value="#e74c3c" onchange="updateClassificationColor('critical', this.value)">
                            <input type="text" id="critical-name" value="Critique" onchange="updateClassificationName('critical', this.value)" 
                                   style="margin-top: 8px; width: 100%; padding: 6px; font-size: 12px; text-align: center; border-radius: 4px; border: 1px solid #ddd;">
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="important-color" class="color-input" value="#f39c12" onchange="updateClassificationColor('important', this.value)">
                            <input type="text" id="important-name" value="Important" onchange="updateClassificationName('important', this.value)" 
                                   style="margin-top: 8px; width: 100%; padding: 6px; font-size: 12px; text-align: center; border-radius: 4px; border: 1px solid #ddd;">
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="info-color" class="color-input" value="#3498db" onchange="updateClassificationColor('info', this.value)">
                            <input type="text" id="info-name" value="Info" onchange="updateClassificationName('info', this.value)" 
                                   style="margin-top: 8px; width: 100%; padding: 6px; font-size: 12px; text-align: center; border-radius: 4px; border: 1px solid #ddd;">
                        </div>
                        <div class="color-input-group">
                            <input type="color" id="success-color" class="color-input" value="#27ae60" onchange="updateClassificationColor('success', this.value)">
                            <input type="text" id="success-name" value="Succ√®s" onchange="updateClassificationName('success', this.value)" 
                                   style="margin-top: 8px; width: 100%; padding: 6px; font-size: 12px; text-align: center; border-radius: 4px; border: 1px solid #ddd;">
                        </div>
                    </div>
                </div>

                <!-- Logo personnalis√© -->
                <div class="section-header">üñºÔ∏è Logo et branding</div>
                
                <div class="logo-editor">
                    <div class="form-group">
                        <div class="tooltip">
                            <label for="logo-url">URL du logo (optionnel) ‚ÑπÔ∏è</label>
                            <span class="tooltiptext">URL publique d'un logo h√©berg√© en ligne (https://...)</span>
                        </div>
                        <input type="url" id="logo-url" placeholder="https://exemple.com/logo.png" onchange="handleLogoUrl()">
                    </div>
                    
                    <div class="form-group">
                        <div class="tooltip">
                            <label for="logo-file">Ou t√©l√©charger un fichier ‚ÑπÔ∏è</label>
                            <span class="tooltiptext">Glissez-d√©posez ou s√©lectionnez un fichier image (PNG, JPG, SVG)</span>
                        </div>
                        <input type="file" id="logo-file" accept="image/*" onchange="handleLogoFile(event)">
                        <div id="drop-zone">
                            <p style="margin: 0; color: #666;">üìÅ Glissez-d√©posez votre logo ici</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="logo-position">Position du logo</label>
                        <select id="logo-position" onchange="updateLogoPosition()">
                            <option value="">Pas de logo</option>
                            <option value="top-left">Haut gauche</option>
                            <option value="top-center">Haut centre</option>
                            <option value="top-right">Haut droite</option>
                            <option value="bottom-left">Bas gauche</option>
                            <option value="bottom-center">Bas centre</option>
                            <option value="bottom-right">Bas droite</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <div class="tooltip">
                            <label for="logo-size">Taille du logo (px) ‚ÑπÔ∏è</label>
                            <span class="tooltiptext">Largeur maximale en pixels (recommand√© : 80-200px)</span>
                        </div>
                        <input type="range" id="logo-size" value="120" min="50" max="300" 
                               oninput="document.getElementById('logo-size-value').textContent = this.value + 'px'; updateLogoSize();">
                        <div style="text-align: center; margin-top: 5px;">
                            <span id="logo-size-value" style="font-weight: bold; color: var(--primary-color);">120px</span>
                        </div>
                    </div>
                    
                    <img id="logo-preview" class="logo-preview" style="display: none;">
                </div>

                <!-- Timeline personnalis√©e -->
                <div class="section-header">‚è±Ô∏è Timeline de progression</div>
                
                <div class="timeline-editor">
                    <div class="tooltip" style="margin-bottom: 15px;">
                        <h4 style="color: var(--primary-color);">Flux de la proc√©dure ‚ÑπÔ∏è</h4>
                        <span class="tooltiptext">D√©finissez les grandes phases de votre proc√©dure d'urgence</span>
                    </div>
                    <div id="timeline-items-container">
                        <!-- Les √©l√©ments de timeline seront g√©n√©r√©s ici -->
                    </div>
                    <button class="btn btn-success" onclick="addTimelineItem()">‚ûï Ajouter √©l√©ment</button>
                </div>
                
                <!-- Informations g√©n√©rales -->
                <div class="section-header">üìã Contenu principal</div>
                
                <div class="form-group">
                    <div class="tooltip">
                        <label for="main-title">Titre principal ‚ÑπÔ∏è</label>
                        <span class="tooltiptext">Titre affich√© en grand dans l'en-t√™te (ex: CYBERATTAQUE D√âTECT√âE)</span>
                    </div>
                    <input type="text" id="main-title" value="CYBERATTAQUE D√âTECT√âE" oninput="renderPreview(); autoSave();">
                </div>
                
                <div class="form-group">
                    <div class="tooltip">
                        <label for="main-subtitle">Sous-titre ‚ÑπÔ∏è</label>
                        <span class="tooltiptext">Description sous le titre principal</span>
                    </div>
                    <input type="text" id="main-subtitle" value="Proc√©dure d'urgence - Actions imm√©diates √† entreprendre" oninput="renderPreview(); autoSave();">
                </div>
                
                <div class="form-group">
                    <div class="tooltip">
                        <label for="emergency-message">Message d'urgence ‚ÑπÔ∏è</label>
                        <span class="tooltiptext">Encart de contact d'urgence (num√©ros, email, etc.)</span>
                    </div>
                    <textarea id="emergency-message" oninput="renderPreview(); autoSave();">üö® EN CAS D'URGENCE : Contactez imm√©diatement votre RSSI ou √©quipe cybers√©curit√© üö®</textarea>
                </div>
                
                <div class="form-group">
                    <div class="tooltip">
                        <label for="footer-message">Message de pied de page ‚ÑπÔ∏è</label>
                        <span class="tooltiptext">Texte affich√© en bas de l'infographie</span>
                    </div>
                    <textarea id="footer-message" oninput="renderPreview(); autoSave();">RAPPEL IMPORTANT : Chaque minute compte en cas de cyberattaque
Cette proc√©dure doit √™tre affich√©e et connue de tous les collaborateurs</textarea>
                </div>
                
                <!-- √âtapes de la proc√©dure -->
                <div class="section-header">üìù √âtapes et actions</div>
                
                <div id="steps-container">
                    <!-- Les √©tapes seront g√©n√©r√©es dynamiquement -->
                </div>
                
                <button class="btn btn-success" onclick="addStep()" style="width: 100%; margin-bottom: 20px;">
                    ‚ûï Ajouter une √©tape
                </button>
                
                <!-- Bouton d'export principal -->
                <button class="btn-export" onclick="exportHTML()">
                    üì• T√©l√©charger l'infographie HTML
                </button>

                <!-- Copyright et informations -->
                <div style="background: #f8f9fa; padding: 20px; margin: 30px -20px -20px -20px; border-top: 2px solid #dee2e6; text-align: center; font-size: 12px; color: #6c757d;">
                    <p style="margin: 0;"><strong>G√©n√©rateur Open Source</strong> | Libre pour usage public et personnel</p>
                    <p style="margin: 5px 0 0 0;">Licence commerciale requise pour entreprises priv√©es</p>
                </div>
            </div>
        </div>
        
        <div class="preview-panel">
            <div style="text-align: center; margin-bottom: 20px;">
                <h3 style="color: var(--primary-color); margin-bottom: 10px;">üëÅÔ∏è Aper√ßu en temps r√©el</h3>
                <p style="color: #6c757d; font-size: 14px;">Les modifications s'affichent instantan√©ment ci-dessous</p>
            </div>
            
            <div id="preview-container" class="preview-container">
                <!-- L'aper√ßu sera g√©n√©r√© ici -->
            </div>
        </div>
    </div>

    <!-- Zone de notification -->
    <div id="notification" class="notification"></div>

    <script>
	// ========================================
        // VARIABLES GLOBALES ET CONFIGURATION
        // ========================================

        /**
         * Ic√¥nes disponibles pour les √©tapes
         * Collection de 70+ √©mojis organis√©s par cat√©gorie
         */
        const availableIcons = [
            // Technologie et informatique
            "üñ•Ô∏è", "üíª", "üì±", "‚å®Ô∏è", "üñ±Ô∏è", "üíæ", "üíø", "üìÄ", "üîå", "üîã",
            // S√©curit√© et alertes
            "üõ°Ô∏è", "üîí", "üîì", "üö®", "‚ö†Ô∏è", "üî•", "‚õî", "üö´", "‚≠ï", "‚ùå",
            // Communication et contact
            "üìû", "üìß", "üì®", "üì¨", "üì¢", "üì£", "üîî", "üîï", "üìª", "üì°",
            // Organisation et gestion
            "üë•", "üë§", "üë®‚Äçüíº", "üë©‚Äçüíº", "üè¢", "üèõÔ∏è", "üìã", "üìä", "üìà", "üìâ",
            // Actions et processus
            "‚úÖ", "‚ùé", "‚≠ê", "üéØ", "üèÉ", "‚è∞", "‚è±Ô∏è", "‚è≤Ô∏è", "üîÑ", "üîÉ",
            // Documents et fichiers
            "üìù", "üìÑ", "üìÉ", "üìë", "üóÇÔ∏è", "üìÅ", "üìÇ", "üóÉÔ∏è", "üóÑÔ∏è", "üíº",
            // Urgence et intervention
            "üÜò", "üöë", "üöí", "üëÆ", "üïµÔ∏è", "üí°", "üîç", "üîé", "üî¨", "‚öôÔ∏è"
        ];

        /**
         * S√©parateurs disponibles pour la timeline
         * Options visuelles pour connecter les √©tapes
         */
        const availableSeparators = [
            { value: "‚Üì", label: "Fl√®che bas ‚Üì" },
            { value: "‚Üí", label: "Fl√®che droite ‚Üí" },
            { value: "‚¨áÔ∏è", label: "Fl√®che bas emoji ‚¨áÔ∏è" },
            { value: "‚û°Ô∏è", label: "Fl√®che droite emoji ‚û°Ô∏è" },
            { value: "‚ñº", label: "Triangle bas ‚ñº" },
            { value: "‚ñ∫", label: "Triangle droite ‚ñ∫" },
            { value: "‚§µÔ∏è", label: "Courbe bas ‚§µÔ∏è" },
            { value: "üîΩ", label: "Bouton bas üîΩ" },
            { value: "‚è¨", label: "Double fl√®che ‚è¨" },
            { value: "‚≠ê", label: "√âtoile ‚≠ê" },
            { value: "üî∏", label: "Losange üî∏" },
            { value: "‚ñ™Ô∏è", label: "Carr√© ‚ñ™Ô∏è" },
            { value: "‚Ä¢", label: "Puce ‚Ä¢" },
            { value: "...", label: "Points de suspension ..." },
            { value: "puis", label: "Texte 'puis'" },
            { value: "‚ü©", label: "Chevron ‚ü©" }
        ];

        /**
         * Configuration des th√®mes pr√©d√©finis
         * Palettes de couleurs coh√©rentes pour diff√©rents contextes
         */
        const themes = {
            blue: {
                name: "Bleu Corporate",
                header: "#0056b3",
                timeline: "#3498db", 
                stepNumber: "#2980b9",
                footer: "#34495e",
                emergency: "#e74c3c",
                bodyBg: "#f8f9fa",
                contentBg: "#ffffff",
                stepBg: "#ffffff",
                previewBg: "#f1f3f4"
            },
            red: {
                name: "Rouge Urgence",
                header: "#dc3545",
                timeline: "#ff6b6b", 
                stepNumber: "#c0392b",
                footer: "#2c3e50",
                emergency: "#e74c3c",
                bodyBg: "#fdf2f2",
                contentBg: "#ffffff",
                stepBg: "#ffffff", 
                previewBg: "#fef5f5"
            },
            green: {
                name: "Vert S√©curit√©",
                header: "#27ae60",
                timeline: "#2ecc71",
                stepNumber: "#229954", 
                footer: "#2c3e50",
                emergency: "#e74c3c",
                bodyBg: "#f0f9f0",
                contentBg: "#ffffff",
                stepBg: "#ffffff",
                previewBg: "#f8fff8"
            },
            dark: {
                name: "Sombre Professionnel", 
                header: "#2c3e50",
                timeline: "#7f8c8d",
                stepNumber: "#34495e",
                footer: "#1a252f", 
                emergency: "#e74c3c",
                bodyBg: "#ecf0f1",
                contentBg: "#ffffff",
                stepBg: "#ffffff",
                previewBg: "#f4f6f7"
            }
        };
		
		//Personnalisation compl√®te du CSS
		let cssCustomization = {
			prefix: "",           // Pr√©fixe pour toutes les classes
			container: "",        // Conteneur d'isolation
			includeReset: false,  // Inclure un reset CSS
			customCss: ""         // CSS personnalis√© additionnel
		};

		/**
		 * Met √† jour le pr√©fixe CSS
		 */
		function updateCssPrefix(prefix) {
			// Valider le pr√©fixe (lettres, chiffres, tirets)
			if (prefix && !/^[a-zA-Z0-9-]+$/.test(prefix)) {
				showNotification('Le pr√©fixe doit contenir uniquement des lettres, chiffres et tirets', 'error');
				return;
			}
			cssCustomization.prefix = prefix;
			renderPreview();
			autoSave();
		}

		/**
		 * Met √† jour le conteneur d'isolation
		 */
		function updateCssContainer(container) {
			cssCustomization.container = container;
			autoSave();
		}

		/**
		 * Active/d√©sactive le reset CSS
		 */
		function updateCssReset(includeReset) {
			cssCustomization.includeReset = includeReset;
			autoSave();
		}

		/**
		 * Met √† jour le CSS personnalis√©
		 */
		function updateCustomCss(css) {
			cssCustomization.customCss = css;
			autoSave();
		}

		/**
		 * G√©n√®re le CSS avec les personnalisations
		 */
		function generateCustomizedCss() {
			const prefix = cssCustomization.prefix;
			const container = cssCustomization.container;
			
			// R√©cup√©ration des couleurs
			const headerColor = document.getElementById('header-color').value;
			const timelineColor = document.getElementById('timeline-color').value;
			const stepNumberColor = document.getElementById('step-number-color').value;
			const footerColor = document.getElementById('footer-color').value;
			const emergencyColor = document.getElementById('emergency-color').value;
			const bodyBgColor = document.getElementById('body-bg-color').value;
			const contentBgColor = document.getElementById('content-bg-color').value;
			const stepBgColor = document.getElementById('step-bg-color').value;
			
			// CSS de base avec pr√©fixes appliqu√©s
			let css = `/* G√©n√©r√© par le G√©n√©rateur d'Infographie Cybers√©curit√© v2.0 */
${cssCustomization.includeReset ? `
			/* Reset CSS minimal */
			${container ? container + ' ' : ''}* { margin: 0; padding: 0; box-sizing: border-box; }
			${container ? container + ' ' : ''}img { max-width: 100%; height: auto; }
			` : ''}

			/* Styles de base */
			* { margin: 0; padding: 0; box-sizing: border-box; }
			body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, ${bodyBgColor} 0%, ${adjustBrightness(bodyBgColor, -15)} 100%); min-height: 100vh; padding: 20px; line-height: 1.6; color: #2c3e50; }

			/* Conteneur principal */
			${container ? container + ' ' : ''}.${prefix}container { max-width: 1200px; margin: 0 auto; background: ${contentBgColor}; border-radius: 25px; box-shadow: 0 25px 50px rgba(0,0,0,0.15); overflow: hidden; position: relative; }
			${container ? container + ' ' : ''}.${prefix}container::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 5px; background: linear-gradient(90deg, ${headerColor}, ${timelineColor}, ${stepNumberColor}); }

			/* En-t√™te */
			${container ? container + ' ' : ''}.${prefix}header { background: linear-gradient(135deg, ${headerColor}, ${adjustBrightness(headerColor, -25)}); color: white; text-align: center; padding: 60px 30px; position: relative; overflow: hidden; }
			${container ? container + ' ' : ''}.${prefix}header::before { content: '‚ö†Ô∏è'; font-size: 100px; display: block; margin-bottom: 30px; animation: ${prefix}pulse 2s infinite; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)); }
			@keyframes ${prefix}pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.8; } }
			${container ? container + ' ' : ''}.${prefix}header h1 { font-size: 3.5em; font-weight: 900; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.4); letter-spacing: 3px; text-transform: uppercase; }
			${container ? container + ' ' : ''}.${prefix}header p { font-size: 1.4em; opacity: 0.95; font-weight: 500; max-width: 800px; margin: 0 auto; }
			${container ? container + ' ' : ''}.${prefix}header .${prefix}logo { position: absolute; z-index: 10; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
			${container ? container + ' ' : ''}.${prefix}header .${prefix}logo.${prefix}top-left { top: 30px; left: 30px; }
			${container ? container + ' ' : ''}.${prefix}header .${prefix}logo.${prefix}top-right { top: 30px; right: 30px; }
			${container ? container + ' ' : ''}.${prefix}header .${prefix}logo.${prefix}top-center { top: 30px; left: 50%; transform: translateX(-50%); }

			/* Timeline */
			${container ? container + ' ' : ''}.${prefix}timeline { display: flex; align-items: center; justify-content: center; margin: 40px 0; flex-wrap: wrap; padding: 0 30px; }
			${container ? container + ' ' : ''}.${prefix}timeline-item { margin: 10px; font-weight: 700; font-size: 1.1em; border-radius: 30px; transition: all 0.3s ease; }
			${container ? container + ' ' : ''}.${prefix}timeline-item.${prefix}item { background: linear-gradient(135deg, ${timelineColor}, ${adjustBrightness(timelineColor, -20)}); color: white; padding: 15px 30px; box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
			${container ? container + ' ' : ''}.${prefix}timeline-item.${prefix}separator { background: transparent; color: ${timelineColor}; padding: 10px; font-size: 1.5em; }

			/* Grille des √©tapes */
			${container ? container + ' ' : ''}.${prefix}steps-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 40px; padding: 60px 40px; background: ${contentBgColor}; }
			${container ? container + ' ' : ''}.${prefix}step { background: ${stepBgColor}; border-radius: 20px; padding: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border-left: 8px solid; transition: all 0.3s ease; position: relative; overflow: visible; }
			${container ? container + ' ' : ''}.${prefix}step::before { content: ''; position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1)); border-radius: 50%; transform: translate(30px, -30px); }
			${container ? container + ' ' : ''}.${prefix}step.${prefix}immediate { border-left-color: ${classificationsData.critical.color}; }
			${container ? container + ' ' : ''}.${prefix}step.${prefix}management { border-left-color: ${stepNumberColor}; }
			${container ? container + ' ' : ''}.${prefix}step.${prefix}communication { border-left-color: ${classificationsData.important.color}; }
			${container ? container + ' ' : ''}.${prefix}step.${prefix}continuity { border-left-color: ${classificationsData.success.color}; }
			${container ? container + ' ' : ''}.${prefix}step-number { position: absolute; top: -25px; left: 30px; background: linear-gradient(135deg, ${stepNumberColor}, ${adjustBrightness(stepNumberColor, -25)}); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 900; font-size: 1.5em; box-shadow: 0 8px 25px rgba(0,0,0,0.2); border: 4px solid ${stepBgColor}; z-index: 10; }
			${container ? container + ' ' : ''}.${prefix}step-icon { font-size: 4.5em; margin-bottom: 30px; display: block; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1)); }
			${container ? container + ' ' : ''}.${prefix}step h3 { font-size: 1.8em; margin-bottom: 25px; color: #2c3e50; font-weight: 800; line-height: 1.2; position: relative; z-index: 2; }
			${container ? container + ' ' : ''}.${prefix}step-content { color: #34495e; line-height: 1.8; position: relative; z-index: 2; }

			/* Actions */
			${container ? container + ' ' : ''}.${prefix}action-item { padding: 20px; border-radius: 12px; margin: 18px 0; border-left: 5px solid; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: all 0.3s ease; position: relative; overflow: hidden; }
			${container ? container + ' ' : ''}.${prefix}action-item::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1)); opacity: 0; transition: opacity 0.3s ease; }
			${container ? container + ' ' : ''}.${prefix}action-item.${prefix}critical { border-left-color: ${classificationsData.critical.color}; background: ${hexToRgba(classificationsData.critical.color, 0.08)}; }
			${container ? container + ' ' : ''}.${prefix}action-item.${prefix}important { border-left-color: ${classificationsData.important.color}; background: ${hexToRgba(classificationsData.important.color, 0.08)}; }
			${container ? container + ' ' : ''}.${prefix}action-item.${prefix}info { border-left-color: ${classificationsData.info.color}; background: ${hexToRgba(classificationsData.info.color, 0.08)}; }
			${container ? container + ' ' : ''}.${prefix}action-item.${prefix}success { border-left-color: ${classificationsData.success.color}; background: ${hexToRgba(classificationsData.success.color, 0.08)}; }

			/* Images dans les actions */
			${container ? container + ' ' : ''}.${prefix}action-item img { 
				max-width: 100%; 
				height: auto; 
				max-height: 300px; 
				object-fit: contain; 
				display: block; 
				margin: 15px auto; 
				border-radius: 8px;
				box-shadow: 0 2px 8px rgba(0,0,0,0.1);
			}

			/* Contact d'urgence */
			${container ? container + ' ' : ''}.${prefix}emergency-contact { background: linear-gradient(135deg, ${emergencyColor}, ${adjustBrightness(emergencyColor, -25)}); color: white; padding: 40px; border-radius: 15px; margin: 40px 50px; text-align: center; font-size: 1.3em; font-weight: 700; box-shadow: 0 15px 40px rgba(0,0,0,0.2); position: relative; overflow: hidden; }
			${container ? container + ' ' : ''}.${prefix}emergency-contact::before { content: 'üö®'; position: absolute; top: -20px; right: -20px; font-size: 120px; opacity: 0.1; transform: rotate(15deg); }
			${container ? container + ' ' : ''}.${prefix}emergency-contact::after { content: 'üö®'; position: absolute; bottom: -20px; left: -20px; font-size: 120px; opacity: 0.1; transform: rotate(-15deg); }

			/* Pied de page */
			${container ? container + ' ' : ''}.${prefix}footer { background: linear-gradient(135deg, ${footerColor}, ${adjustBrightness(footerColor, -20)}); color: white; text-align: center; padding: 50px 40px; position: relative; line-height: 1.8; }
			${container ? container + ' ' : ''}.${prefix}footer p { margin-bottom: 15px; font-size: 1.1em; }
			${container ? container + ' ' : ''}.${prefix}footer p:last-child { margin-bottom: 0; font-weight: 600; }
			${container ? container + ' ' : ''}.${prefix}footer .${prefix}logo { position: absolute; z-index: 10; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
			${container ? container + ' ' : ''}.${prefix}footer .${prefix}logo.${prefix}bottom-left { bottom: 30px; left: 30px; }
			${container ? container + ' ' : ''}.${prefix}footer .${prefix}logo.${prefix}bottom-right { bottom: 30px; right: 30px; }
			${container ? container + ' ' : ''}.${prefix}footer .${prefix}logo.${prefix}bottom-center { bottom: 30px; left: 50%; transform: translateX(-50%); }

			/* Responsive */
			@media (max-width: 768px) {
				body { padding: 10px; }
				${container ? container + ' ' : ''}.${prefix}container { border-radius: 15px; }
				${container ? container + ' ' : ''}.${prefix}header { padding: 40px 20px; }
				${container ? container + ' ' : ''}.${prefix}header h1 { font-size: 2.5em; letter-spacing: 1px; }
				${container ? container + ' ' : ''}.${prefix}header p { font-size: 1.1em; }
				${container ? container + ' ' : ''}.${prefix}timeline { flex-direction: column; align-items: stretch; padding: 0 20px; }
				${container ? container + ' ' : ''}.${prefix}timeline-item.${prefix}item { text-align: center; margin: 5px 0; }
				${container ? container + ' ' : ''}.${prefix}steps-grid { grid-template-columns: 1fr; padding: 40px 20px; gap: 30px; }
				${container ? container + ' ' : ''}.${prefix}step { padding: 30px 20px; }
				${container ? container + ' ' : ''}.${prefix}step h3 { font-size: 1.5em; }
				${container ? container + ' ' : ''}.${prefix}emergency-contact { margin: 30px 20px; padding: 30px 20px; font-size: 1.1em; }
				${container ? container + ' ' : ''}.${prefix}footer { padding: 40px 20px; }
				${container ? container + ' ' : ''}.${prefix}header .${prefix}logo, ${container ? container + ' ' : ''}.${prefix}footer .${prefix}logo { position: relative !important; display: block; margin: 20px auto; transform: none !important; }
			}

			/* Print */
			@media print {
				body { background: white; padding: 0; }
				${container ? container + ' ' : ''}.${prefix}container { box-shadow: none; border-radius: 0; max-width: none; }
				${container ? container + ' ' : ''}.${prefix}step { page-break-inside: avoid; }
				${container ? container + ' ' : ''}.${prefix}emergency-contact::before, ${container ? container + ' ' : ''}.${prefix}emergency-contact::after { animation: none; }
			}

			/* Accessibilit√© */
			@media (prefers-reduced-motion: reduce) {
				* { animation-duration: 0.01ms !important; animation-iteration-count: 1 !important; transition-duration: 0.01ms !important; }
			}

			@media (prefers-color-scheme: dark) {
				${container ? container + ' ' : ''}.${prefix}action-item { box-shadow: 0 4px 15px rgba(255,255,255,0.05); }
			}`;

				// Ajouter le CSS personnalis√©
				if (cssCustomization.customCss) {
					css += `\n\n/* CSS personnalis√© */\n${cssCustomization.customCss}`;
				}
				
			return css;
		}

		/**
		 * Pr√©visualise le CSS g√©n√©r√©
		 */
		function previewCssOutput() {
			const css = generateCustomizedCss();
			
			// Cr√©er une modal pour afficher le CSS
			const modal = document.createElement('div');
			modal.style.cssText = `
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0,0,0,0.8);
				display: flex;
				justify-content: center;
				align-items: center;
				z-index: 30000;
			`;
			
			modal.innerHTML = `
				<div style="background: white; padding: 30px; border-radius: 15px; max-width: 80%; max-height: 80%; overflow: auto;">
					<h3 style="margin-bottom: 20px;">CSS g√©n√©r√© avec personnalisations</h3>
					<pre style="background: #f8f9fa; padding: 20px; border-radius: 8px; overflow: auto; max-height: 400px;">
						<code>${css.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</code>
					</pre>
					<button class="btn btn-primary" onclick="this.parentElement.parentElement.remove()" style="margin-top: 20px;">
						Fermer
					</button>
				</div>
			`;
			
			document.body.appendChild(modal);
		}

        // ========================================
        // DONN√âES DE L'APPLICATION
        // ========================================

        /**
         * Structure de donn√©es pour la timeline
         * D√©finit le flux visuel de la proc√©dure
         */
        let timelineData = [
            { text: "IMM√âDIAT", type: "item" },
            { text: "‚Üì", type: "separator" },
            { text: "ALERTE", type: "item" },
            { text: "‚Üì", type: "separator" },
            { text: "COMMUNICATION", type: "item" },
            { text: "‚Üì", type: "separator" },
            { text: "CONTINUIT√â", type: "item" }
        ];

        /**
         * Configuration du logo
         * G√®re l'affichage et le positionnement du logo
         */
        let logoData = {
            url: "",           // URL externe du logo
            file: "",          // Logo upload√© (base64)
            position: "",      // Position sur la page
            size: 120          // Taille en pixels
        };

        /**
         * Classifications personnalisables des actions
         * 4 niveaux de priorit√© avec couleurs et noms modifiables
         */
        let classificationsData = {
            critical: { name: "Critique", color: "#e74c3c" },
            important: { name: "Important", color: "#f39c12" },
            info: { name: "Info", color: "#3498db" },
            success: { name: "Succ√®s", color: "#27ae60" }
        };

        /**
         * Donn√©es par d√©faut des √©tapes de la proc√©dure
         * Structure compl√®te avec exemples pr√©-remplis
         */
        let stepsData = [
            {
                number: 1,
                icon: "üñ•Ô∏è",
                title: "ACTIONS IMM√âDIATES",
                category: "immediate",
                actions: [
                    { type: "critical", text: "<strong>NE PAS √âTEINDRE</strong> votre ordinateur/serveur" },
                    { type: "critical", text: "<strong>D√âCONNECTER IMM√âDIATEMENT</strong> du r√©seau :<br>‚Ä¢ D√©brancher le c√¢ble Ethernet<br>‚Ä¢ D√©sactiver le WiFi" },
                    { type: "important", text: "Isoler physiquement le poste compromis" },
                    { type: "important", text: "Noter l'heure exacte et les sympt√¥mes observ√©s" }
                ]
            },
            {
                number: 2,
                icon: "üë•",
                title: "ALERTE HI√âRARCHIQUE",
                category: "management",
                actions: [
                    { type: "important", text: "<strong>Responsable de service :</strong><br>Pr√©venir imm√©diatement tous vos agents" },
                    { type: "important", text: "Remonter l'information √† la direction g√©n√©rale" },
                    { type: "important", text: "Contacter l'√©quipe IT/cybers√©curit√©" },
                    { type: "info", text: "Activer la cellule de crise si elle existe" }
                ]
            },
            {
                number: 3,
                icon: "üîá",
                title: "MA√éTRISE COMMUNICATION",
                category: "communication",
                actions: [
                    { type: "critical", text: "<strong>INTERDICTION ABSOLUE</strong> de communiquer sans aval de la direction" },
                    { type: "important", text: "Pas de d√©claration publique, r√©seaux sociaux, presse" },
                    { type: "info", text: "Centraliser toute communication via un porte-parole d√©sign√©" },
                    { type: "info", text: "Pr√©parer des √©l√©ments de langage avec la direction" }
                ]
            },
            {
                number: 4,
                icon: "üìã",
                title: "PLAN DE CONTINUIT√â",
                category: "continuity",
                actions: [
                    { type: "success", text: "<strong>Activer les fiches r√©flexes</strong> du Plan de Continuit√© M√©tier (PCM)" },
                    { type: "success", text: "Identifier les processus critiques √† maintenir" },
                    { type: "success", text: "Basculer sur les solutions de secours pr√©vues" },
                    { type: "info", text: "Documenter toutes les actions entreprises" }
                ]
            }
        ];
		
		// ========================================
		// FONCTIONS DE S√âCURIT√â
		// ========================================

		/**
		 * √âchappe les caract√®res HTML dangereux
		 * @param {string} unsafe - Texte potentiellement dangereux
		 * @returns {string} Texte s√©curis√©
		 */
		function escapeHtml(unsafe) {
			if (typeof unsafe !== 'string') return '';
			
			const map = {
				'&': '&amp;',
				'<': '&lt;',
				'>': '&gt;',
				'"': '&quot;',
				"'": '&#039;',
				'/': '&#x2F;'
			};
			
			return unsafe.replace(/[&<>"'/]/g, char => map[char]);
		}

		/**
		 * Nettoie le HTML en gardant certaines balises autoris√©es
		 * @param {string} html - HTML √† nettoyer
		 * @returns {string} HTML nettoy√©
		 */
		function sanitizeHtml(html) {
			if (typeof html !== 'string') return '';
			
			// D'abord √©chapper le HTML dangereux
			let safe = html
				.replace(/&/g, '&amp;')
				.replace(/</g, '&lt;')
				.replace(/>/g, '&gt;')
				.replace(/"/g, '&quot;')
				.replace(/'/g, '&#039;');
			
			// Puis r√©autoriser seulement les balises s√ªres
			const allowedTags = ['strong', 'em', 'u', 'br', 'p', 'ul', 'li', 'b', 'i'];
			
			allowedTags.forEach(tag => {
				const openRegex = new RegExp(`&lt;(${tag})&gt;`, 'gi');
				safe = safe.replace(openRegex, '<$1>');
				const closeRegex = new RegExp(`&lt;/(${tag})&gt;`, 'gi');
				safe = safe.replace(closeRegex, '</$1>');
			});
			
			return safe;
		}

		/**
		 * Valide une URL pour s'assurer qu'elle est s√ªre
		 * @param {string} url - URL √† valider
		 * @returns {boolean} true si l'URL est valide et s√ªre
		 */
		function isValidUrl(url) {
			if (!url || typeof url !== 'string') return false;
			
			try {
				const parsed = new URL(url);
				// Autoriser seulement HTTPS et data: URIs pour les images
				return ['https:', 'data:', 'http:'].includes(parsed.protocol);
			} catch (e) {
				return false;
			}
		}

		/**
		 * Valide et nettoie les donn√©es d'un projet import√©
		 * @param {object} projectData - Donn√©es du projet
		 * @returns {boolean} true si les donn√©es sont valides
		 */
		function validateProjectData(projectData) {
			// V√©rifications de base
			if (!projectData || typeof projectData !== 'object') return false;
			if (!projectData.version || !projectData.settings) return false;
			
			// Limites de s√©curit√©
			const MAX_STEPS = 50;
			const MAX_ACTIONS = 200;
			const MAX_STRING_LENGTH = 10000;
			const MAX_TIMELINE_ITEMS = 30;
			
			// V√©rifier les longueurs de cha√Ænes
			const checkStringLength = (str) => {
				return typeof str === 'string' && str.length <= MAX_STRING_LENGTH;
			};
			
			// V√©rifier les settings
			if (projectData.settings) {
				const settings = projectData.settings;
				if (!checkStringLength(settings.mainTitle)) return false;
				if (!checkStringLength(settings.mainSubtitle)) return false;
				if (!checkStringLength(settings.emergencyMessage)) return false;
				if (!checkStringLength(settings.footerMessage)) return false;
			}
			
			// V√©rifier la timeline
			if (projectData.timeline) {
				if (!Array.isArray(projectData.timeline)) return false;
				if (projectData.timeline.length > MAX_TIMELINE_ITEMS) return false;
			}
			
			// V√©rifier les √©tapes
			if (projectData.steps) {
				if (!Array.isArray(projectData.steps)) return false;
				if (projectData.steps.length > MAX_STEPS) return false;
				
				let totalActions = 0;
				for (const step of projectData.steps) {
					if (typeof step !== 'object') return false;
					if (!checkStringLength(step.title)) return false;
					
					if (step.actions) {
						if (!Array.isArray(step.actions)) return false;
						totalActions += step.actions.length;
						if (totalActions > MAX_ACTIONS) return false;
						
						for (const action of step.actions) {
							if (!checkStringLength(action.text)) return false;
						}
					}
				}
			}
			
			return true;
		}

        // ========================================
        // GESTION DE L'INTERFACE UTILISATEUR
        // ========================================

        /**
         * Affiche ou masque les sections FAQ
         * @param {string} faqId - Identifiant de la section FAQ
         */
        function toggleFaq(faqId) {
            const content = document.getElementById(faqId);
            const arrow = document.getElementById(faqId + '-arrow');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                arrow.textContent = '‚ñº';
            } else {
                // Fermer toutes les autres FAQ
                document.querySelectorAll('.faq-content.active').forEach(otherContent => {
                    if (otherContent.id !== faqId) {
                        otherContent.classList.remove('active');
                        const otherArrow = document.getElementById(otherContent.id + '-arrow');
                        if (otherArrow) otherArrow.textContent = '‚ñº';
                    }
                });
                
                content.classList.add('active');
                arrow.textContent = '‚ñ≤';
            }
        }

        /**
         * Affiche une notification temporaire
         * @param {string} message - Texte de la notification
         * @param {string} type - Type de notification (success, error, info)
         */
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            
            // Afficher
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Masquer apr√®s 3 secondes
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        /**
         * Applique un th√®me pr√©d√©fini
         * @param {string} themeName - Nom du th√®me √† appliquer
         */
        function applyTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;

            // Mettre √† jour les valeurs des champs de couleur
            document.getElementById('header-color').value = theme.header;
            document.getElementById('timeline-color').value = theme.timeline;
            document.getElementById('step-number-color').value = theme.stepNumber;
            document.getElementById('footer-color').value = theme.footer;
            document.getElementById('emergency-color').value = theme.emergency;
            document.getElementById('body-bg-color').value = theme.bodyBg;
            document.getElementById('content-bg-color').value = theme.contentBg;
            document.getElementById('step-bg-color').value = theme.stepBg;
            document.getElementById('preview-bg-color').value = theme.previewBg;

            // Mettre √† jour l'interface
            updateThemeSelector(themeName);
            renderPreview();
            
            showNotification(`Th√®me "${theme.name}" appliqu√© avec succ√®s !`, 'success');
        }

        /**
         * Met √† jour le s√©lecteur de th√®me
         * @param {string} activeTheme - Th√®me actuellement actif
         */
        function updateThemeSelector(activeTheme) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            document.querySelector(`.theme-${activeTheme}`).classList.add('active');
        }

        // ========================================
        // GESTION DE LA TIMELINE
        // ========================================

        /**
         * G√©n√®re l'√©diteur de timeline
         * Interface pour modifier la s√©quence d'√©tapes
         */
        function renderTimelineEditor() {
            const container = document.getElementById('timeline-items-container');
            container.innerHTML = '';
            
            timelineData.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'timeline-item-editor fade-in';
                
                let separatorOptions = '';
                if (item.type === 'separator') {
                    separatorOptions = availableSeparators.map(sep => 
                        `<option value="${sep.value}" ${item.text === sep.value ? 'selected' : ''}>${sep.label}</option>`
                    ).join('');
                }
                
                itemDiv.innerHTML = `
                    <select onchange="updateTimelineItem(${index}, 'type', this.value)" style="width: 120px;">
                        <option value="item" ${item.type === 'item' ? 'selected' : ''}>üìç √âl√©ment</option>
                        <option value="separator" ${item.type === 'separator' ? 'selected' : ''}>‚û°Ô∏è S√©parateur</option>
                    </select>
                    ${item.type === 'separator' ? 
                        `<select class="timeline-separator-input" onchange="updateTimelineItem(${index}, 'text', this.value)">
                            ${separatorOptions}
                        </select>` :
                        `<input type="text" class="timeline-item-input" value="${escapeHtml(item.text)}" onchange="updateTimelineItem(${index}, 'text', this.value)" placeholder="Nom de l'√©tape">`
                    }
                    <button class="btn btn-danger" onclick="removeTimelineItem(${index})" title="Supprimer cet √©l√©ment">
                        üóëÔ∏è
                    </button>
                `;
                container.appendChild(itemDiv);
            });
        }
		
		/**
		 * G√®re l'upload d'image pour une action
		 */
		function handleActionImageFile(stepIndex, actionIndex, event) {
			const file = event.target.files[0];
			if (file) {
				// V√©rifications similaires au logo
				const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/svg+xml', 'image/gif'];
				if (!allowedTypes.includes(file.type)) {
					showNotification('Type de fichier non support√©. Utilisez PNG, JPG ou SVG.', 'error');
					return;
				}
				
				// V√©rifier le nom du fichier
				const safeFileName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
				if (safeFileName !== file.name) {
					console.warn('Nom de fichier potentiellement dangereux d√©tect√©');
				}
				
				//Warning sur la taille du fichier recommand√©e
				if (file.size > 500 * 1024) { // Limite √† 500KB
					showNotification('Image recommand√©e : maximum 500KB pour une meilleure performance.', 'warning');
				}

				//Taille maximale de l'image
				if (file.size > 2 * 1024 * 1024) { // Limite √† 2MB pour les images d'action
					showNotification('Fichier trop volumineux. Maximum 2MB.', 'error');
					return;
				}

				// V√©rifier que c'est vraiment une image
				const reader = new FileReader();
				reader.onload = function(e) {
					const img = new Image();
					img.onload = function() {
						// L'image est valide, continuer
						if (!stepsData[stepIndex].actions[actionIndex].image) {
							stepsData[stepIndex].actions[actionIndex].image = {
								url: "",
								file: "",
								width: 350,
								position: "below"
							};
						}
						stepsData[stepIndex].actions[actionIndex].image.file = e.target.result;
						stepsData[stepIndex].actions[actionIndex].image.url = "";
						
						renderEditor();
						renderPreview();
						autoSave();
						showNotification('Image charg√©e avec succ√®s', 'success');
					};
					img.onerror = function() {
						showNotification('Le fichier s√©lectionn√© n\'est pas une image valide', 'error');
					};
					img.src = e.target.result;
				};
				reader.readAsDataURL(file);
			}
		}

		/**
		 * G√®re l'URL d'image pour une action
		 */
		function handleActionImageUrl(stepIndex, actionIndex, url) {
			// Validation de l'URL
			if (url && !isValidUrl(url)) {
				showNotification('URL invalide. Utilisez une URL HTTPS valide.', 'error');
				return;
			}
			
			if (!stepsData[stepIndex].actions[actionIndex].image) {
				stepsData[stepIndex].actions[actionIndex].image = {
					url: "",
					file: "",
					width: 350,
					position: "below"
				};
			}
			
			stepsData[stepIndex].actions[actionIndex].image.url = url;
			stepsData[stepIndex].actions[actionIndex].image.file = "";
			renderPreview();
			autoSave();
		}

		/**
		 * Met √† jour les param√®tres de l'image d'une action
		 */
		function updateActionImage(stepIndex, actionIndex, field, value) {
			if (!stepsData[stepIndex].actions[actionIndex].image) {
				stepsData[stepIndex].actions[actionIndex].image = {
					url: "",
					file: "",
					width: 350,
					position: "below"
				};
			}
			stepsData[stepIndex].actions[actionIndex].image[field] = field === 'width' ? parseInt(value) : value;
			renderPreview();
			autoSave();
		}

		/**
		 * Supprime l'image d'une action
		 */
		function removeActionImage(stepIndex, actionIndex) {
			delete stepsData[stepIndex].actions[actionIndex].image;
			renderEditor();
			renderPreview();
			autoSave();
			showNotification('Image supprim√©e', 'info');
		}

        /**
         * Met √† jour un √©l√©ment de la timeline
         * @param {number} index - Index de l'√©l√©ment √† modifier
         * @param {string} field - Champ √† modifier (type, text)
         * @param {string} value - Nouvelle valeur
         */
        function updateTimelineItem(index, field, value) {
            timelineData[index][field] = value;
            renderTimelineEditor();
            renderPreview();
            autoSave();
        }

        /**
         * Ajoute un nouvel √©l√©ment √† la timeline
         */
        function addTimelineItem() {
			
			if (timelineData.length >= 30) {
				showNotification('Nombre maximum d\'√©l√©ments timeline atteint (30)', 'error');
				return;
			}
			
            timelineData.push({ text: "NOUVELLE √âTAPE", type: "item" });
            renderTimelineEditor();
            renderPreview();
            autoSave();
            showNotification('Nouvel √©l√©ment ajout√© √† la timeline', 'success');
        }

        /**
         * Supprime un √©l√©ment de la timeline
         * @param {number} index - Index de l'√©l√©ment √† supprimer
         */
        function removeTimelineItem(index) {
            if (timelineData.length <= 1) {
                showNotification('Impossible de supprimer le dernier √©l√©ment', 'error');
                return;
            }
            
            timelineData.splice(index, 1);
            renderTimelineEditor();
            renderPreview();
            autoSave();
            showNotification('√âl√©ment supprim√© de la timeline', 'info');
        }

        // ========================================
        // GESTION DES LOGOS
        // ========================================

        /**
         * G√®re les logos via URL
         */
        function handleLogoUrl() {
			const url = document.getElementById('logo-url').value;
			if (url) {
				// Validation de l'URL
				if (!isValidUrl(url)) {
					showNotification('URL invalide. Utilisez une URL HTTPS valide.', 'error');
					document.getElementById('logo-url').value = '';
					return;
				}
				
				logoData.url = url;
				logoData.file = "";
				const preview = document.getElementById('logo-preview');
				preview.src = url;
				preview.style.display = 'block';
				
				// Gestion d'erreur de chargement
				preview.onerror = function() {
					showNotification('Impossible de charger l\'image depuis cette URL', 'error');
					logoData.url = "";
					preview.style.display = 'none';
					document.getElementById('logo-url').value = '';
				};
				
				renderPreview();
				autoSave();
				showNotification('Logo charg√© depuis l\'URL', 'success');
			}
		}

		/**
		 * G√®re l'upload de logo via fichier
		 * @param {Event} event - √âv√©nement de s√©lection de fichier
		 */
		function handleLogoFile(event) {
			const file = event.target.files[0];
			if (file) {
				// V√©rification du type de fichier
				const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/svg+xml', 'image/gif'];
				if (!allowedTypes.includes(file.type)) {
					showNotification('Type de fichier non support√©. Utilisez PNG, JPG ou SVG.', 'error');
					return;
				}
				
				// V√©rifier le nom du fichier
				const safeFileName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
				if (safeFileName !== file.name) {
					console.warn('Nom de fichier potentiellement dangereux d√©tect√©');
				}
				
				// V√©rification de la taille (max 5MB)
				if (file.size > 5 * 1024 * 1024) {
					showNotification('Fichier trop volumineux. Maximum 5MB.', 'error');
					return;
				}

				// V√©rifier que c'est vraiment une image
				const reader = new FileReader();
				reader.onload = function(e) {
					const img = new Image();
					img.onload = function() {
						// L'image est valide
						logoData.file = e.target.result;
						logoData.url = "";
						const preview = document.getElementById('logo-preview');
						preview.src = e.target.result;
						preview.style.display = 'block';
						renderPreview();
						autoSave();
						showNotification('Logo charg√© avec succ√®s', 'success');
					};
					img.onerror = function() {
						showNotification('Le fichier s√©lectionn√© n\'est pas une image valide', 'error');
					};
					img.src = e.target.result;
				};
				reader.readAsDataURL(file);
			}
		}

        /**
         * Met √† jour la position du logo
         */
        function updateLogoPosition() {
            logoData.position = document.getElementById('logo-position').value;
            renderPreview();
            autoSave();
        }

        /**
         * Met √† jour la taille du logo
         */
        function updateLogoSize() {
            logoData.size = parseInt(document.getElementById('logo-size').value);
            renderPreview();
            autoSave();
        }

        // ========================================
        // GESTION DU DRAG & DROP POUR LES LOGOS
        // ========================================

        /**
         * Initialise le drag & drop pour les logos
         */
        function initializeDragDrop() {
            const dropZone = document.getElementById('drop-zone');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });

            function highlight(e) {
                dropZone.style.borderColor = 'var(--primary-color)';
                dropZone.style.backgroundColor = '#f0f7ff';
                dropZone.classList.add('dragover');
            }

            function unhighlight(e) {
                dropZone.style.borderColor = '#ccc';
                dropZone.style.backgroundColor = 'transparent';
                dropZone.classList.remove('dragover');
            }

            dropZone.addEventListener('drop', handleDrop, false);

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    document.getElementById('logo-file').files = files;
                    handleLogoFile({ target: { files: files } });
                }
            }
        }

        // ========================================
        // GESTION DES CLASSIFICATIONS
        // ========================================

        /**
         * Met √† jour le nom d'une classification
         * @param {string} type - Type de classification (critical, important, info, success)
         * @param {string} name - Nouveau nom
         */
        function updateClassificationName(type, name) {
            classificationsData[type].name = name;
            renderEditor();
            renderPreview();
            autoSave();
        }

        /**
         * Met √† jour la couleur d'une classification
         * @param {string} type - Type de classification
         * @param {string} color - Nouvelle couleur (hex)
         */
        function updateClassificationColor(type, color) {
            classificationsData[type].color = color;
            renderPreview();
            autoSave();
        }

        // ========================================
        // GESTION DES LICENCES
        // ========================================

        /**
         * Affiche la modal de licence
         */
        function showLicense() {
            document.getElementById('licenseModal').style.display = 'flex';
        }

        /**
         * Masque la modal de licence
         */
        function hideLicense() {
            document.getElementById('licenseModal').style.display = 'none';
        }

        // ========================================
        // FONCTIONS UTILITAIRES COULEURS
        // ========================================

        /**
         * Ajuste la luminosit√© d'une couleur hexad√©cimale
         * @param {string} hex - Couleur hexad√©cimale (#RRGGBB)
         * @param {number} amount - Quantit√© d'ajustement (-255 √† +255)
         * @returns {string} Nouvelle couleur hexad√©cimale
         */
        function adjustBrightness(hex, amount) {
            const usePound = hex[0] === '#';
            const col = usePound ? hex.slice(1) : hex;
            const num = parseInt(col, 16);
            let r = (num >> 16) + amount;
            let g = (num >> 8 & 0x00FF) + amount;
            let b = (num & 0x0000FF) + amount;
            r = r > 255 ? 255 : r < 0 ? 0 : r;
            g = g > 255 ? 255 : g < 0 ? 0 : g;
            b = b > 255 ? 255 : b < 0 ? 0 : b;
            return (usePound ? '#' : '') + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
        }

        /**
         * Convertit une couleur hexad√©cimale en RGBA
         * @param {string} hex - Couleur hexad√©cimale
         * @param {number} alpha - Valeur alpha (0-1)
         * @returns {string} Couleur RGBA
         */
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        /**
         * Sauvegarde automatique dans le localStorage
         * Appel√©e √† chaque modification pour √©viter la perte de donn√©es
         */
        function autoSave() {
			try {
				const projectData = {
					version: "2.0",
					timestamp: new Date().toISOString(),
					projectName: document.getElementById('project-name').value,
					settings: {
						mainTitle: document.getElementById('main-title').value,
						mainSubtitle: document.getElementById('main-subtitle').value,
						emergencyMessage: document.getElementById('emergency-message').value,
						footerMessage: document.getElementById('footer-message').value,
						colors: {
							header: document.getElementById('header-color').value,
							timeline: document.getElementById('timeline-color').value,
							stepNumber: document.getElementById('step-number-color').value,
							footer: document.getElementById('footer-color').value,
							emergency: document.getElementById('emergency-color').value,
							bodyBg: document.getElementById('body-bg-color').value,
							contentBg: document.getElementById('content-bg-color').value,
							stepBg: document.getElementById('step-bg-color').value,
							previewBg: document.getElementById('preview-bg-color').value
						}
					},
					timeline: timelineData,
					steps: stepsData,
					logo: logoData,
					classifications: classificationsData,
					cssCustomization: cssCustomization  
				};
				
				localStorage.setItem('cyberattack_generator_autosave', JSON.stringify(projectData));
			} catch (error) {
				console.warn('Erreur lors de la sauvegarde automatique:', error);
			}
		}

	// ========================================
        // GESTION DES √âTAPES ET ACTIONS
        // ========================================

        /**
		 * G√©n√®re l'√©diteur des √©tapes
		 * Interface compl√®te pour modifier les √©tapes et leurs actions
		 */
		function renderEditor() {
			const container = document.getElementById('steps-container');
			container.innerHTML = '';
			
			stepsData.forEach((step, stepIndex) => {
				const stepDiv = document.createElement('div');
				stepDiv.className = 'step-editor fade-in';
				stepDiv.innerHTML = `
					<div class="step-header">
						<div class="tooltip">
							<input type="number" class="step-number-input" value="${step.number}" 
								   onchange="updateStep(${stepIndex}, 'number', this.value)" min="1" max="99">
							<span class="tooltiptext">Num√©ro d'ordre de l'√©tape</span>
						</div>
						<div style="position: relative;">
							<div class="tooltip">
								<input type="text" class="step-icon-input" value="${escapeHtml(step.icon)}" 
									   onchange="updateStep(${stepIndex}, 'icon', this.value)" 
									   onclick="showIconSelector(${stepIndex})" readonly 
									   style="cursor: pointer;" title="Cliquer pour choisir une ic√¥ne">
								<span class="tooltiptext">Cliquez pour choisir une ic√¥ne</span>
							</div>
							<div id="icon-selector-${stepIndex}" class="icon-selector" 
								 style="display: none; position: absolute; top: 100%; left: 0; z-index: 1000;">
								${availableIcons.map(icon => 
									`<div class="icon-option" onclick="selectIcon(${stepIndex}, '${icon}')" title="${icon}">${icon}</div>`
								).join('')}
							</div>
						</div>
						<div style="flex: 1; margin-left: 15px;">
							<div class="tooltip">
								<input type="text" style="width: 100%;" value="${escapeHtml(step.title)}" 
									   onchange="updateStep(${stepIndex}, 'title', this.value)" 
									   placeholder="Titre de l'√©tape">
								<span class="tooltiptext">Titre descriptif de l'√©tape</span>
							</div>
						</div>
					</div>
					
					<div class="form-group">
						<div class="tooltip">
							<label>Cat√©gorie d'√©tape ‚ÑπÔ∏è</label>
							<span class="tooltiptext">D√©termine la couleur de bordure et le style visuel</span>
						</div>
						<select onchange="updateStep(${stepIndex}, 'category', this.value)">
							<option value="immediate" ${step.category === 'immediate' ? 'selected' : ''}>üö® Imm√©diat (Rouge vif)</option>
							<option value="management" ${step.category === 'management' ? 'selected' : ''}>üë• Gestion (Bleu fonc√©)</option>
							<option value="communication" ${step.category === 'communication' ? 'selected' : ''}>üì¢ Communication (Orange)</option>
							<option value="continuity" ${step.category === 'continuity' ? 'selected' : ''}>‚úÖ Continuit√© (Vert)</option>
						</select>
					</div>
					
					<div class="form-group">
						<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
							<div class="tooltip">
								<label style="margin: 0;">Actions de cette √©tape ‚ÑπÔ∏è</label>
								<span class="tooltiptext">Liste des t√¢ches √† r√©aliser dans cette √©tape</span>
							</div>
							<button class="btn btn-primary" onclick="addAction(${stepIndex})" title="Ajouter une nouvelle action">
								‚ûï Nouvelle action
							</button>
						</div>
						
						<div id="actions-${stepIndex}">
							${step.actions.map((action, actionIndex) => `
								<div class="action-item-editor">
									<div class="action-controls">
										<div class="tooltip">
											<select onchange="updateAction(${stepIndex}, ${actionIndex}, 'type', this.value)" style="min-width: 120px;">
												<option value="critical" ${action.type === 'critical' ? 'selected' : ''}>${classificationsData.critical.name}</option>
												<option value="important" ${action.type === 'important' ? 'selected' : ''}>${classificationsData.important.name}</option>
												<option value="info" ${action.type === 'info' ? 'selected' : ''}>${classificationsData.info.name}</option>
												<option value="success" ${action.type === 'success' ? 'selected' : ''}>${classificationsData.success.name}</option>
											</select>
											<span class="tooltiptext">Niveau de priorit√© de cette action</span>
										</div>
										<button class="btn btn-danger" onclick="removeAction(${stepIndex}, ${actionIndex})" 
												title="Supprimer cette action">üóëÔ∏è</button>
									</div>
									
									<div class="text-editor-toolbar">
										<button class="toolbar-btn" onclick="formatText(${stepIndex}, ${actionIndex}, 'bold')" 
												title="Texte en gras"><strong>B</strong></button>
										<button class="toolbar-btn" onclick="formatText(${stepIndex}, ${actionIndex}, 'italic')" 
												title="Texte en italique"><em>I</em></button>
										<button class="toolbar-btn" onclick="formatText(${stepIndex}, ${actionIndex}, 'underline')" 
												title="Texte soulign√©"><u>U</u></button>
										<button class="toolbar-btn" onclick="formatText(${stepIndex}, ${actionIndex}, 'br')" 
												title="Saut de ligne">‚Üµ</button>
										<button class="toolbar-btn" onclick="formatText(${stepIndex}, ${actionIndex}, 'bullet')" 
												title="Liste √† puces">‚Ä¢ Liste</button>
									</div>
									
									<textarea id="action-text-${stepIndex}-${actionIndex}" 
											  onchange="updateAction(${stepIndex}, ${actionIndex}, 'text', this.value)" 
											  placeholder="D√©crivez l'action √† r√©aliser..." 
											  style="min-height: 80px;">${action.text}</textarea>
									
									<div class="action-image-editor" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px;">
										<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
											<label style="font-size: 12px; font-weight: 600; color: #6c757d;">üì∑ Image- taille raisonable (optionnel)</label>
											${action.image ? `<button class="btn btn-danger" style="padding: 4px 8px; font-size: 11px;" onclick="removeActionImage(${stepIndex}, ${actionIndex})">üóëÔ∏è Supprimer</button>` : ''}
										</div>
										
										<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px;">
											<input type="url" placeholder="URL de l'image" 
												   value="${escapeHtml(action.image?.url || '')}"
												   onchange="handleActionImageUrl(${stepIndex}, ${actionIndex}, this.value)"
												   style="font-size: 12px; padding: 6px;">
											<input type="file" id="action-image-${stepIndex}-${actionIndex}" 
												   accept="image/*" 
												   onchange="handleActionImageFile(${stepIndex}, ${actionIndex}, event)"
												   style="font-size: 12px;">
										</div>
										
										${action.image && (action.image.url || action.image.file) ? `
											<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
												<div>
													<label style="font-size: 11px; color: #6c757d;">Position</label>
													<select onchange="updateActionImage(${stepIndex}, ${actionIndex}, 'position', this.value)"
															style="width: 100%; font-size: 12px; padding: 4px;">
														<option value="below" ${action.image.position === 'below' ? 'selected' : ''}>Sous le texte</option>
														<option value="above" ${action.image.position === 'above' ? 'selected' : ''}>Au-dessus du texte</option>
													</select>
												</div>
												<div>
													<label style="font-size: 11px; color: #6c757d;">Largeur: <span style="color: var(--primary-color);">${action.image.width}px</span></label>
													<input type="range" value="${action.image.width}" min="100" max="450" 
														   onchange="updateActionImage(${stepIndex}, ${actionIndex}, 'width', this.value)"
														   style="width: 100%;">
												</div>
											</div>
											<img src="${action.image.url || action.image.file}" 
												 style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 4px; border: 1px solid #dee2e6;">
										` : ''}
									</div>
								</div>
							`).join('')}
						</div>
					</div>
					
					<div style="display: flex; gap: 10px; justify-content: space-between; margin-top: 20px;">
						<button class="btn btn-success" onclick="duplicateStep(${stepIndex})" title="Dupliquer cette √©tape">
							üìã Dupliquer
						</button>
						<button class="btn btn-danger" onclick="removeStep(${stepIndex})" title="Supprimer cette √©tape">
							üóëÔ∏è Supprimer √©tape
						</button>
					</div>
				`;
				container.appendChild(stepDiv);
			});
		}

        /**
         * Met √† jour une √©tape
         * @param {number} stepIndex - Index de l'√©tape
         * @param {string} field - Champ √† modifier
         * @param {string} value - Nouvelle valeur
         */
        function updateStep(stepIndex, field, value) {
            stepsData[stepIndex][field] = field === 'number' ? parseInt(value) : value;
            
            if (field === 'icon') {
                renderEditor();
            }
            
            renderPreview();
            autoSave();
        }

        /**
         * Met √† jour une action
         * @param {number} stepIndex - Index de l'√©tape
         * @param {number} actionIndex - Index de l'action
         * @param {string} field - Champ √† modifier
         * @param {string} value - Nouvelle valeur
         */
        function updateAction(stepIndex, actionIndex, field, value) {
            stepsData[stepIndex].actions[actionIndex][field] = value;
            renderPreview();
            autoSave();
        }

        /**
         * Ajoute une nouvelle √©tape
         */
        function addStep() {
            if (stepsData.length >= 50) {
				showNotification('Nombre maximum d\'√©tapes atteint (50)', 'error');
				return;
			}
			
			const newNumber = Math.max(...stepsData.map(s => s.number)) + 1;
            stepsData.push({
                number: newNumber,
                icon: "‚ùì",
                title: "NOUVELLE √âTAPE",
                category: "info",
                actions: [
                    { type: "info", text: "Nouvelle action √† d√©finir" }
                ]
            });
            renderEditor();
            renderPreview();
            autoSave();
            showNotification('Nouvelle √©tape ajout√©e', 'success');
        }

        /**
         * Duplique une √©tape existante
         * @param {number} stepIndex - Index de l'√©tape √† dupliquer
         */
        function duplicateStep(stepIndex) {
            const originalStep = stepsData[stepIndex];
            const newStep = JSON.parse(JSON.stringify(originalStep)); // Clone profond
            newStep.number = Math.max(...stepsData.map(s => s.number)) + 1;
            newStep.title = originalStep.title + " (Copie)";
            
            stepsData.splice(stepIndex + 1, 0, newStep);
            renderEditor();
            renderPreview();
            autoSave();
            showNotification('√âtape dupliqu√©e avec succ√®s', 'success');
        }

        /**
         * Supprime une √©tape
         * @param {number} stepIndex - Index de l'√©tape √† supprimer
         */
        function removeStep(stepIndex) {
            if (stepsData.length <= 1) {
                showNotification('Impossible de supprimer la derni√®re √©tape', 'error');
                return;
            }
            
            stepsData.splice(stepIndex, 1);
            renderEditor();
            renderPreview();
            autoSave();
            showNotification('√âtape supprim√©e', 'info');
        }

        /**
         * Ajoute une action √† une √©tape
         * @param {number} stepIndex - Index de l'√©tape
         */
        function addAction(stepIndex) {
		
			if (stepsData[stepIndex].actions.length >= 20) {
				showNotification('Nombre maximum d\'actions par √©tape atteint (20)', 'error');
				return;
			}
			
            stepsData[stepIndex].actions.push({
                type: "info",
                text: "Nouvelle action"
            });
            renderEditor();
            renderPreview();
            autoSave();
            showNotification('Nouvelle action ajout√©e', 'success');
        }

        /**
         * Supprime une action
         * @param {number} stepIndex - Index de l'√©tape
         * @param {number} actionIndex - Index de l'action
         */
        function removeAction(stepIndex, actionIndex) {
            if (stepsData[stepIndex].actions.length <= 1) {
                showNotification('Impossible de supprimer la derni√®re action', 'error');
                return;
            }
            
            stepsData[stepIndex].actions.splice(actionIndex, 1);
            renderEditor();
            renderPreview();
            autoSave();
            showNotification('Action supprim√©e', 'info');
        }

        /**
         * Affiche le s√©lecteur d'ic√¥nes pour une √©tape
         * @param {number} stepIndex - Index de l'√©tape
         */
        function showIconSelector(stepIndex) {
            // Fermer tous les autres s√©lecteurs
            document.querySelectorAll('.icon-selector').forEach(selector => {
                selector.style.display = 'none';
            });
            
            // Ouvrir/fermer le s√©lecteur pour cette √©tape
            const selector = document.getElementById(`icon-selector-${stepIndex}`);
            selector.style.display = selector.style.display === 'none' ? 'grid' : 'none';
        }

        /**
         * S√©lectionne une ic√¥ne pour une √©tape
         * @param {number} stepIndex - Index de l'√©tape
         * @param {string} icon - Ic√¥ne s√©lectionn√©e
         */
        function selectIcon(stepIndex, icon) {
            updateStep(stepIndex, 'icon', icon);
            document.getElementById(`icon-selector-${stepIndex}`).style.display = 'none';
            showNotification(`Ic√¥ne ${icon} s√©lectionn√©e`, 'success');
        }

        /**
         * Applique un formatage au texte s√©lectionn√©
         * @param {number} stepIndex - Index de l'√©tape
         * @param {number} actionIndex - Index de l'action
         * @param {string} format - Type de formatage (bold, italic, underline, br, bullet)
         */
        function formatText(stepIndex, actionIndex, format) {
            const textarea = document.getElementById(`action-text-${stepIndex}-${actionIndex}`);
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText;
            
            if (selectedText) {
                switch(format) {
                    case 'bold':
                        formattedText = `<strong>${selectedText}</strong>`;
                        break;
                    case 'italic':
                        formattedText = `<em>${selectedText}</em>`;
                        break;
                    case 'underline':
                        formattedText = `<u>${selectedText}</u>`;
                        break;
                    case 'br':
                        formattedText = selectedText + '<br>';
                        break;
                    case 'bullet':
                        const lines = selectedText.split('\n').filter(line => line.trim());
                        formattedText = lines.map(line => `‚Ä¢ ${line.trim()}`).join('<br>');
                        break;
                    default:
                        formattedText = selectedText;
                }
                
                const newText = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
                textarea.value = newText;
                updateAction(stepIndex, actionIndex, 'text', newText);
                
            } else {
                // Si aucun texte s√©lectionn√©, ins√©rer √† la position du curseur
                const cursorPos = textarea.selectionStart;
                let insertText = '';
                
                switch(format) {
                    case 'br':
                        insertText = '<br>';
                        break;
                    case 'bullet':
                        insertText = '‚Ä¢ ';
                        break;
                    case 'bold':
                        insertText = '<strong></strong>';
                        break;
                    case 'italic':
                        insertText = '<em></em>';
                        break;
                    case 'underline':
                        insertText = '<u></u>';
                        break;
                }
                
                if (insertText) {
                    const newText = textarea.value.substring(0, cursorPos) + insertText + textarea.value.substring(cursorPos);
                    textarea.value = newText;
                    updateAction(stepIndex, actionIndex, 'text', newText);
                    
                    // Positionner le curseur entre les balises pour bold, italic, underline
                    if (['bold', 'italic', 'underline'].includes(format)) {
                        const tagLength = format === 'bold' ? 8 : format === 'italic' ? 4 : 3;
                        textarea.setSelectionRange(cursorPos + tagLength, cursorPos + tagLength);
                        textarea.focus();
                    }
                }
            }
        }

        // ========================================
        // G√âN√âRATION DE L'APER√áU
        // ========================================

        /**
		 * G√©n√®re l'aper√ßu en temps r√©el de l'infographie
		 */
		function renderPreview() {
			const container = document.getElementById('preview-container');
			if (!container) {
				console.warn('Preview container not found');
				return;
			}
			const mainTitle = document.getElementById('main-title').value;
			const mainSubtitle = document.getElementById('main-subtitle').value;
			const emergencyMessage = document.getElementById('emergency-message').value;
			const footerMessage = document.getElementById('footer-message').value;
			
			// R√©cup√©ration des couleurs principales
			const headerColor = document.getElementById('header-color').value;
			const timelineColor = document.getElementById('timeline-color').value;
			const stepNumberColor = document.getElementById('step-number-color').value;
			const footerColor = document.getElementById('footer-color').value;
			const emergencyColor = document.getElementById('emergency-color').value;
			
			// R√©cup√©ration des couleurs d'arri√®re-plan
			const bodyBgColor = document.getElementById('body-bg-color').value;
			const contentBgColor = document.getElementById('content-bg-color').value;
			const stepBgColor = document.getElementById('step-bg-color').value;
			const previewBgColor = document.getElementById('preview-bg-color').value;
			
			// Application des couleurs d'arri√®re-plan √† l'interface
			document.body.style.background = `linear-gradient(135deg, ${bodyBgColor} 0%, ${adjustBrightness(bodyBgColor, -10)} 100%)`;
			document.querySelector('.preview-panel').style.background = previewBgColor;
			
			// G√©n√©ration du logo
			const logoSrc = logoData.url || logoData.file;
			const logoHtml = logoSrc && logoData.position ? 
				`<img src="${logoSrc}" class="logo ${logoData.position}" style="max-width: ${logoData.size}px; height: auto; max-height: 100px;">` : '';
			
			// CORRECTION: Utiliser les bonnes classes CSS
			container.innerHTML = `
				<div class="preview-container" style="background: ${contentBgColor};">
					<div class="preview-header" style="background: linear-gradient(135deg, ${headerColor}, ${adjustBrightness(headerColor, -20)});">
						${logoData.position && logoData.position.startsWith('top') ? logoHtml : ''}
						<h1>${escapeHtml(mainTitle)}</h1>
						<p>${escapeHtml(mainSubtitle)}</p>
					</div>
					
					<div class="preview-timeline">
						${timelineData.map(item => 
							item.type === 'item' 
								? `<div class="preview-timeline-item" style="background: linear-gradient(135deg, ${timelineColor}, ${adjustBrightness(timelineColor, -15)});">${escapeHtml(item.text)}</div>`
								: `<div class="preview-timeline-item" style="background: transparent; color: ${timelineColor}; font-size: 1.2em;">${escapeHtml(item.text)}</div>`
						).join('')}
					</div>
					
					<div class="preview-steps-grid">
						${stepsData.map(step => `
							<div class="preview-step ${step.category}" style="border-left-color: ${getCategoryColor(step.category)}; background: ${stepBgColor};">
								<div class="preview-step-number" style="background: linear-gradient(135deg, ${stepNumberColor}, ${adjustBrightness(stepNumberColor, -20)});">${step.number}</div>
								<div class="preview-step-icon">${escapeHtml(step.icon)}</div>
								<h3>${escapeHtml(step.title)}</h3>
								<div class="preview-step-content">
									${step.actions.map(action => {
										const imageSrc = action.image?.url || action.image?.file;
										const imageHtml = imageSrc ? 
											`<img src="${imageSrc}" style="max-width: ${action.image.width}px; width: 100%; height: auto; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">` : '';
										
										return `
											<div class="preview-action-item ${action.type}" style="border-left-color: ${getActionColor(action.type)}; background: ${getActionBackgroundColor(action.type)};">
												${action.image?.position === 'above' ? imageHtml : ''}
												${sanitizeHtml(action.text)}
												${action.image?.position === 'below' ? imageHtml : ''}
											</div>
										`;
									}).join('')}
								</div>
							</div>
						`).join('')}
					</div>
					
					<div class="preview-emergency-contact" style="background: linear-gradient(135deg, ${emergencyColor}, ${adjustBrightness(emergencyColor, -20)});">
						${escapeHtml(emergencyMessage)}
					</div>
					
					<div class="preview-footer" style="background: linear-gradient(135deg, ${footerColor}, ${adjustBrightness(footerColor, -15)});">
						${logoData.position && logoData.position.startsWith('bottom') ? logoHtml : ''}
						${footerMessage.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('')}
					</div>
				</div>
			`;
		}

        /**
         * D√©termine la couleur d'une cat√©gorie d'√©tape
         */
        function getCategoryColor(category) {
            const stepNumberColor = document.getElementById('step-number-color').value;
            
            switch(category) {
                case 'immediate': return classificationsData.critical.color;
                case 'management': return stepNumberColor;
                case 'communication': return classificationsData.important.color;
                case 'continuity': return classificationsData.success.color;
                default: return stepNumberColor;
            }
        }

        /**
         * Obtient la couleur d'une action selon son type
         */
        function getActionColor(type) {
            return classificationsData[type]?.color || '#3498db';
        }

        /**
         * G√©n√®re la couleur de fond d'une action
         */
        function getActionBackgroundColor(type) {
            const color = classificationsData[type]?.color || '#3498db';
            return hexToRgba(color, 0.1);
        }

        // ========================================
        // GESTION DE LA SAUVEGARDE ET CHARGEMENT
        // ========================================

        /**
         * Charge la sauvegarde automatique
         */
        function loadAutoSave() {
            try {
                const saved = localStorage.getItem('cyberattack_generator_autosave');
                if (saved) {
                    const projectData = JSON.parse(saved);
                    loadProjectData(projectData);
                    showNotification('Projet pr√©c√©dent restaur√© automatiquement', 'info');
                }
            } catch (error) {
                console.warn('Erreur lors du chargement automatique:', error);
            }
        }

        /**
         * Sauvegarde le projet dans un fichier JSON
         */
        function saveProjectToFile() {
            const projectName = document.getElementById('project-name').value || 'Mon_infographie_cyberattaque';
            
            const projectData = {
                version: "2.0",
                timestamp: new Date().toISOString(),
                projectName: projectName,
                settings: {
                    mainTitle: document.getElementById('main-title').value,
                    mainSubtitle: document.getElementById('main-subtitle').value,
                    emergencyMessage: document.getElementById('emergency-message').value,
                    footerMessage: document.getElementById('footer-message').value,
                    colors: {
                        header: document.getElementById('header-color').value,
                        timeline: document.getElementById('timeline-color').value,
                        stepNumber: document.getElementById('step-number-color').value,
                        footer: document.getElementById('footer-color').value,
                        emergency: document.getElementById('emergency-color').value,
                        bodyBg: document.getElementById('body-bg-color').value,
                        contentBg: document.getElementById('content-bg-color').value,
                        stepBg: document.getElementById('step-bg-color').value,
                        previewBg: document.getElementById('preview-bg-color').value
                    }
                },
                timeline: timelineData,
                steps: stepsData,
                logo: logoData,
                classifications: classificationsData,
				cssCustomization: cssCustomization
            };
            
            const blob = new Blob([JSON.stringify(projectData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${projectName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Projet sauvegard√© avec succ√®s', 'success');
        }

        /**
         * G√®re le chargement d'un fichier de projet
         */
        function handleLoadFile(event) {
			const file = event.target.files[0];
			if (!file) return;
			
			if (!file.name.endsWith('.json')) {
				showNotification('Veuillez s√©lectionner un fichier JSON', 'error');
				return;
			}
			
			const reader = new FileReader();
			reader.onload = function(e) {
				try {
					const projectData = JSON.parse(e.target.result);
					
					// AJOUTER ICI : Validation des donn√©es
					if (!validateProjectData(projectData)) {
						showNotification('Fichier de projet invalide ou corrompu', 'error');
						return;
					}
					
					loadProjectData(projectData);
					showNotification(`Projet "${projectData.projectName}" charg√© avec succ√®s`, 'success');
				} catch (error) {
					showNotification('Erreur lors du chargement du fichier', 'error');
					console.error('Erreur de chargement:', error);
				}
			};
			reader.readAsText(file);
		}

        /**
         * Charge les donn√©es d'un projet
         */
        function loadProjectData(projectData) {
            if (!projectData.version) {
                showNotification('Format de fichier non reconnu', 'error');
                return;
            }
            
            // Chargement des param√®tres g√©n√©raux
            if (projectData.settings) {
                document.getElementById('main-title').value = projectData.settings.mainTitle || '';
                document.getElementById('main-subtitle').value = projectData.settings.mainSubtitle || '';
                document.getElementById('emergency-message').value = projectData.settings.emergencyMessage || '';
                document.getElementById('footer-message').value = projectData.settings.footerMessage || '';
                document.getElementById('project-name').value = projectData.projectName || '';
                
                // Chargement des couleurs
                if (projectData.settings.colors) {
                    const colors = projectData.settings.colors;
                    document.getElementById('header-color').value = colors.header || '#dc3545';
                    document.getElementById('timeline-color').value = colors.timeline || '#3498db';
                    document.getElementById('step-number-color').value = colors.stepNumber || '#0056b3';
                    document.getElementById('footer-color').value = colors.footer || '#2c3e50';
                    document.getElementById('emergency-color').value = colors.emergency || '#ff6b6b';
                    document.getElementById('body-bg-color').value = colors.bodyBg || '#f8f9fa';
                    document.getElementById('content-bg-color').value = colors.contentBg || '#ffffff';
                    document.getElementById('step-bg-color').value = colors.stepBg || '#ffffff';
                    document.getElementById('preview-bg-color').value = colors.previewBg || '#f8f9fa';
                }
            }
            
            // Chargement des donn√©es sp√©cifiques
            if (projectData.timeline) timelineData = projectData.timeline;
            if (projectData.steps) stepsData = projectData.steps;
            if (projectData.logo) logoData = { ...logoData, ...projectData.logo };
            if (projectData.classifications) classificationsData = { ...classificationsData, ...projectData.classifications };
			
			if (projectData.cssCustomization) {
				cssCustomization = { ...cssCustomization, ...projectData.cssCustomization };
				document.getElementById('css-prefix').value = cssCustomization.prefix || '';
				document.getElementById('css-container').value = cssCustomization.container || '';
				document.getElementById('css-reset').checked = cssCustomization.includeReset || false;
				document.getElementById('custom-css').value = cssCustomization.customCss || '';
			}
            
            // Mise √† jour de l'interface
            initializeClassifications();
            renderTimelineEditor();
            renderEditor();
            renderPreview();
            
            // Gestion du logo
            if (logoData.file || logoData.url) {
                const preview = document.getElementById('logo-preview');
                preview.src = logoData.url || logoData.file;
                preview.style.display = 'block';
                document.getElementById('logo-position').value = logoData.position || '';
                document.getElementById('logo-size').value = logoData.size || 120;
                document.getElementById('logo-size-value').textContent = (logoData.size || 120) + 'px';
            }
        }

        /**
         * Remet √† z√©ro le projet
         */
        function resetProject() {
            if (confirm('√ätes-vous s√ªr de vouloir recommencer ? Toutes vos modifications seront perdues.')) {
                // R√©initialisation des donn√©es par d√©faut
                timelineData = [
                    { text: "IMM√âDIAT", type: "item" },
                    { text: "‚Üì", type: "separator" },
                    { text: "ALERTE", type: "item" },
                    { text: "‚Üì", type: "separator" },
                    { text: "COMMUNICATION", type: "item" },
                    { text: "‚Üì", type: "separator" },
                    { text: "CONTINUIT√â", type: "item" }
                ];
                
                logoData = { url: "", file: "", position: "", size: 120 };
                
                classificationsData = {
                    critical: { name: "Critique", color: "#e74c3c" },
                    important: { name: "Important", color: "#f39c12" },
                    info: { name: "Info", color: "#3498db" },
                    success: { name: "Succ√®s", color: "#27ae60" }
                };
                
                stepsData = [
                    {
                        number: 1, icon: "üñ•Ô∏è", title: "ACTIONS IMM√âDIATES", category: "immediate",
                        actions: [
                            { type: "critical", text: "<strong>NE PAS √âTEINDRE</strong> votre ordinateur/serveur" },
                            { type: "critical", text: "<strong>D√âCONNECTER IMM√âDIATEMENT</strong> du r√©seau :<br>‚Ä¢ D√©brancher le c√¢ble Ethernet<br>‚Ä¢ D√©sactiver le WiFi" },
                            { type: "important", text: "Isoler physiquement le poste compromis" },
                            { type: "important", text: "Noter l'heure exacte et les sympt√¥mes observ√©s" }
                        ]
                    },
                    {
                        number: 2, icon: "üë•", title: "ALERTE HI√âRARCHIQUE", category: "management",
                        actions: [
                            { type: "important", text: "<strong>Responsable de service :</strong><br>Pr√©venir imm√©diatement tous vos agents" },
                            { type: "important", text: "Remonter l'information √† la direction g√©n√©rale" },
                            { type: "important", text: "Contacter l'√©quipe IT/cybers√©curit√©" },
                            { type: "info", text: "Activer la cellule de crise si elle existe" }
                        ]
                    },
                    {
                        number: 3, icon: "üîá", title: "MA√éTRISE COMMUNICATION", category: "communication",
                        actions: [
                            { type: "critical", text: "<strong>INTERDICTION ABSOLUE</strong> de communiquer sans aval de la direction" },
                            { type: "important", text: "Pas de d√©claration publique, r√©seaux sociaux, presse" },
                            { type: "info", text: "Centraliser toute communication via un porte-parole d√©sign√©" },
                            { type: "info", text: "Pr√©parer des √©l√©ments de langage avec la direction" }
                       ]
                   },
                   {
                       number: 4, icon: "üìã", title: "PLAN DE CONTINUIT√â", category: "continuity",
                       actions: [
                           { type: "success", text: "<strong>Activer les fiches r√©flexes</strong> du Plan de Continuit√© M√©tier (PCM)" },
                           { type: "success", text: "Identifier les processus critiques √† maintenir" },
                           { type: "success", text: "Basculer sur les solutions de secours pr√©vues" },
                           { type: "info", text: "Documenter toutes les actions entreprises" }
                       ]
                   }
               ];
               
               // R√©initialisation des champs
               document.getElementById('main-title').value = 'CYBERATTAQUE D√âTECT√âE';
               document.getElementById('main-subtitle').value = 'Proc√©dure d\'urgence - Actions imm√©diates √† entreprendre';
               document.getElementById('emergency-message').value = 'üö® EN CAS D\'URGENCE : Contactez imm√©diatement votre RSSI ou √©quipe cybers√©curit√© üö®';
               document.getElementById('footer-message').value = 'RAPPEL IMPORTANT : Chaque minute compte en cas de cyberattaque\nCette proc√©dure doit √™tre affich√©e et connue de tous les collaborateurs';
               document.getElementById('project-name').value = 'Mon infographie cyberattaque';
               
               // Appliquer le th√®me bleu par d√©faut
               applyTheme('blue');
               
               showNotification('Projet r√©initialis√©', 'info');
           }
       }

       // ========================================
       // EXPORT HTML
       // ========================================

       /**
        * Exporte l'infographie compl√®te en fichier HTML autonome
        */
       function exportHTML() {
           const projectName = escapeHtml(document.getElementById('project-name').value || 'infographie-cyberattaque');
  		   const mainTitle = escapeHtml(document.getElementById('main-title').value);
		   const mainSubtitle = escapeHtml(document.getElementById('main-subtitle').value);
		   const emergencyMessage = escapeHtml(document.getElementById('emergency-message').value);
		   const footerMessage = document.getElementById('footer-message').value; // Sera trait√© ligne par ligne
           
           // R√©cup√©ration des couleurs
           const headerColor = document.getElementById('header-color').value;
           const timelineColor = document.getElementById('timeline-color').value;
           const stepNumberColor = document.getElementById('step-number-color').value;
           const footerColor = document.getElementById('footer-color').value;
           const emergencyColor = document.getElementById('emergency-color').value;
           const bodyBgColor = document.getElementById('body-bg-color').value;
           const contentBgColor = document.getElementById('content-bg-color').value;
           const stepBgColor = document.getElementById('step-bg-color').value;
		   
		   // Variables CSS personnalis√©es
		   const prefix = cssCustomization.prefix || '';
		   const container = cssCustomization.container || '';
           
           // Logo
           const logoSrc = logoData.url || logoData.file;
		   const logoHtml = logoSrc && logoData.position ? 
				`<img src="${logoSrc}" class="${prefix}logo ${prefix}${logoData.position}" style="max-width: ${logoData.size}px; height: auto; max-height: 120px;">` : '';
			   
			// Utiliser le CSS personnalis√©
			const customizedCss = generateCustomizedCss();
           
           const htmlContent = `<!DOCTYPE html>
		   <!--
				G√©n√©r√© par le G√©n√©rateur d'Infographie Cybers√©curit√© v2.0
				Copyright (C) 2025 [Guillemin Pierre-Eric]
				
				Ce fichier est soumis √† la licence AGPL-3.0 pour usage non-commercial.
				Licence commerciale requise pour usage en entreprise.
				
				Source : [A venir]
				Licence : [pe.guillemin@mairie-tarbes]
			-->
			<html lang="fr">
			<head>
				<meta charset="UTF-8">
				<meta name="viewport" content="width=device-width, initial-scale=1.0">
				<meta http-equiv="X-Content-Type-Options" content="nosniff">
				<meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
				<meta name="referrer" content="strict-origin-when-cross-origin">
				<!-- Ajouter si possible sur le serveur : Content-Security-Policy -->
				<meta http-equiv="Content-Security-Policy" content="default-src 'self' data:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: http:;">
				<title>${escapeHtml(mainTitle)} - Proc√©dure d'urgence cybers√©curit√©</title>
			   <meta name="description" content="Infographie de proc√©dure d'urgence en cas de cyberattaque - ${projectName}">
			   <meta name="generator" content="G√©n√©rateur Open Source Cybers√©curit√© v2.0">
			   <style>
					${customizedCss}
			   </style>
			</head>
			<body>
			   ${container ? `<div id="${container.replace('#', '').replace('.', '')}">` : ''}
			   <div class="${prefix}container">
				   <div class="${prefix}header">
					   ${logoData.position && logoData.position.startsWith('top') ? logoHtml : ''}
					   <h1>${mainTitle}</h1>
					   <p>${mainSubtitle}</p>
				   </div>
				   
				   <div class="${prefix}timeline">
					   ${timelineData.map(item => `
					   <div class="${prefix}timeline-item ${prefix}${item.type}">${escapeHtml(item.text)}</div>
					   `).join('')}
				   </div>
				   
				   <div class="${prefix}steps-grid">
					   ${stepsData.map(step => `
					   <div class="${prefix}step ${prefix}${step.category}">
						   <div class="${prefix}step-number">${step.number}</div>
						   <div class="${prefix}step-icon" role="img" aria-label="Ic√¥ne ${escapeHtml(step.icon)}">${escapeHtml(step.icon)}</div>
						   <h3>${escapeHtml(step.title)}</h3>
						   <div class="${prefix}step-content">
								${step.actions.map(action => {
									const imageSrc = action.image?.url || action.image?.file;
									const imageHtml = imageSrc ? 
										`<img src="${imageSrc}" style="max-width: ${action.image.width}px; width: 100%; height: auto; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">` : '';
									
									return `
									<div class="${prefix}action-item ${prefix}${action.type}">
										${action.image?.position === 'above' ? imageHtml : ''}
										${sanitizeHtml(action.text)}
										${action.image?.position === 'below' ? imageHtml : ''}
									</div>
									`;
								}).join('')}
							</div>
					   </div>
					   `).join('')}
				   </div>
				   
				   <div class="${prefix}emergency-contact">
					   ${emergencyMessage}
				   </div>
				   
				   <div class="${prefix}footer">
					   ${logoData.position && logoData.position.startsWith('bottom') ? logoHtml : ''}
					   ${footerMessage.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('')}
				   </div>
			   </div>
			   ${container ? '</div>' : ''}

				<script>
				   console.log('üìã Infographie g√©n√©r√©e par le G√©n√©rateur Open Source Cybers√©curit√© v2.0');
				   console.log('üè∑Ô∏è Projet: ${projectName}');
				   console.log('üìÖ G√©n√©r√© le: ${new Date().toLocaleString('fr-FR')}');
				   console.log('‚öñÔ∏è Licence: Gratuit pour usage public et personnel - Licence commerciale requise pour entreprises');
				   console.log('üìä Statistiques: ${stepsData.length} √©tapes ‚Ä¢ ${stepsData.reduce((total, step) => total + step.actions.length, 0)} actions ‚Ä¢ ${timelineData.filter(item => item.type === 'item').length} √©l√©ments de timeline');
				   ${cssCustomization.prefix ? `console.log('üé® CSS avec pr√©fixe: ${cssCustomization.prefix}');` : ''}
				   ${cssCustomization.container ? `console.log('üì¶ Conteneur d\\'isolation: ${cssCustomization.container}');` : ''}
			    <\/script>
			</body>
			</html>`;
				
				// G√©n√©ration et t√©l√©chargement du fichier
				const blob = new Blob([htmlContent], { type: 'text/html;charset=utf-8' });
				const url = URL.createObjectURL(blob);
				const a = document.createElement('a');
				a.href = url;
				const filename = `${projectName.replace(/[^a-zA-Z0-9]/g, '_')}_${new Date().toISOString().split('T')[0]}.html`;
				a.download = filename;
				document.body.appendChild(a);
				a.click();
				document.body.removeChild(a);
				URL.revokeObjectURL(url);
				
				showNotification(`Infographie export√©e: ${filename}`, 'success');
			}

       // ========================================
       // FONCTIONS DE TOOLBAR ET INTERFACES
       // ========================================

       /**
        * Initialise les classifications dans l'interface
        */
       function initializeClassifications() {
           document.getElementById('critical-color').value = classificationsData.critical.color;
           document.getElementById('critical-name').value = classificationsData.critical.name;
           document.getElementById('important-color').value = classificationsData.important.color;
           document.getElementById('important-name').value = classificationsData.important.name;
           document.getElementById('info-color').value = classificationsData.info.color;
           document.getElementById('info-name').value = classificationsData.info.name;
           document.getElementById('success-color').value = classificationsData.success.color;
           document.getElementById('success-name').value = classificationsData.success.name;
       }

       /**
        * Fonctions directement appel√©es par les boutons de la toolbar
        */
       function saveProject() {
           autoSave();
           showNotification('Projet sauvegard√© localement', 'success');
       }

       function loadProject() {
           document.getElementById('load-file').click();
       }

       // ========================================
       // INITIALISATION DE L'APPLICATION
       // ========================================


         /**
		 * Point d'entr√©e principal - Initialisation compl√®te
		 */
		function initializeApp() {
			console.log('üöÄ Initialisation du G√©n√©rateur d\'Infographie Cybers√©curit√© v2.0');
			console.log('üìÑ Licence : AGPL-3.0 (usage public) / Commerciale (entreprises)');
			console.log('‚öñÔ∏è Copyright (C) 2025 [Guillemin Pierre-Eric]');
			
			// V√©rification premi√®re utilisation
			if (!localStorage.getItem('license_accepted')) {
				showLicense();
				localStorage.setItem('license_accepted', 'true');
			}
			
			try {
				// 1. D'abord initialiser les composants de base
				initializeClassifications();
				initializeDragDrop();
				
				// 2. Appliquer le th√®me par d√©faut AVANT de charger une sauvegarde
				applyTheme('blue');
				updateThemeSelector('blue');
				
				// 3. Rendu initial avec les valeurs par d√©faut
				renderTimelineEditor();
				renderEditor();
				renderPreview();
				
				// 4. Ensuite seulement, charger la sauvegarde automatique (qui √©crasera les valeurs par d√©faut)
				setTimeout(() => {
					loadAutoSave();
					// Re-rendre apr√®s le chargement de la sauvegarde
					renderPreview();
				}, 100);
				
				// 5. Event listeners pour fermer les s√©lecteurs d'ic√¥nes
				document.addEventListener('click', function(e) {
					if (!e.target.closest('.step-icon-input') && !e.target.closest('.icon-selector')) {
						document.querySelectorAll('.icon-selector').forEach(selector => {
							selector.style.display = 'none';
						});
					}
				});

				// 6. Raccourcis clavier
				document.addEventListener('keydown', function(e) {
					if (e.ctrlKey && e.key === 's') {
						e.preventDefault();
						saveProjectToFile();
					}
					
					if (e.ctrlKey && e.key === 'e') {
						e.preventDefault();
						exportHTML();
					}
					
					if (e.ctrlKey && e.key === 'n') {
						e.preventDefault();
						resetProject();
					}
				});
				
				console.log('‚úÖ Application initialis√©e avec succ√®s');
				showNotification('G√©n√©rateur pr√™t √† utiliser !', 'success');
				
			} catch (error) {
				console.error('‚ùå Erreur lors de l\'initialisation:', error);
				showNotification('Erreur lors de l\'initialisation', 'error');
			}
		}

       // ========================================
       // D√âMARRAGE DE L'APPLICATION
       // ========================================

       // D√©marrage automatique quand le DOM est pr√™t
       if (document.readyState === 'loading') {
           document.addEventListener('DOMContentLoaded', initializeApp);
       } else {
           initializeApp();
       }

       // Sauvegarde automatique avant fermeture
       window.addEventListener('beforeunload', function(e) {
           autoSave();
       });

       // Gestion de la visibilit√© pour √©conomiser les ressources
       document.addEventListener('visibilitychange', function() {
           if (document.hidden) {
               autoSave();
           }
       });
	   
	   </script>
	   
	   //Imprimer le contenu sur du papier ou en PDF

	   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


		<script>

		//Impression en tant qu'image
		function printAsImage() {
			const preview = document.getElementById("preview-container");
			const formatSelect = document.getElementById("print-format");
			const selectedFormat = formatSelect.value;

			// Afficher un indicateur de chargement
			showNotification('G√©n√©ration de l\'aper√ßu d\'impression en cours...', 'info');

			// Dimensions pour l'impression (en pixels √† 96 DPI)
			const formatSizes = {
				"A4-portrait": { width: 794, height: 1123, name: "A4 Portrait" },
				"A4-landscape": { width: 1123, height: 794, name: "A4 Paysage" },
				"A3-portrait": { width: 1123, height: 1587, name: "A3 Portrait" },
				"A3-landscape": { width: 1587, height: 1123, name: "A3 Paysage" }
			};

			const format = formatSizes[selectedFormat];
			
			// Cr√©er un clone temporaire pour forcer la mise en page
			const tempContainer = preview.cloneNode(true);
			tempContainer.style.position = 'absolute';
			tempContainer.style.left = '-9999px';
			tempContainer.style.top = '0';
			tempContainer.style.width = format.width + 'px';
			tempContainer.style.visibility = 'hidden';
			
			// Forcer la grille des √©tapes √† rester en multi-colonnes
			const stepsGrid = tempContainer.querySelector('.preview-steps-grid');
			if (stepsGrid) {
				// Ajuster la grille selon le format
				if (selectedFormat.includes('portrait')) {
					stepsGrid.style.gridTemplateColumns = 'repeat(1, 1fr)';
				} else {
					// Paysage : 2 colonnes
					stepsGrid.style.gridTemplateColumns = 'repeat(2, 1fr)';
				}
				stepsGrid.style.gap = '30px';
			}
			
			// Ajuster d'autres √©l√©ments pour l'impression
			const container = tempContainer.querySelector('.preview-container');
			if (container) {
				container.style.maxWidth = '100%';
				container.style.margin = '0';
				container.style.boxShadow = 'none';
			}
			
			// Ajouter temporairement au DOM
			document.body.appendChild(tempContainer);
			
			// Options pour html2canvas avec une meilleure qualit√©
			const html2canvasOptions = {
				useCORS: true,
				scale: 2, // Augmenter la r√©solution pour une meilleure qualit√© d'impression
				backgroundColor: "#ffffff",
				logging: false,
				width: format.width,
				height: tempContainer.scrollHeight,
				windowWidth: format.width,
				windowHeight: tempContainer.scrollHeight
			};

			// Capturer le clone au lieu de l'original
			html2canvas(tempContainer, html2canvasOptions).then(canvas => {
				// Supprimer le clone temporaire
				document.body.removeChild(tempContainer);
				// Calculer les dimensions pour l'ajustement
				const imgWidth = canvas.width;
				const imgHeight = canvas.height;
				const pageWidth = format.width;
				const pageHeight = format.height;
				
				// Calculer le ratio pour que l'image tienne sur une page
				const widthRatio = pageWidth / imgWidth;
				const heightRatio = pageHeight / imgHeight;
				const ratio = Math.min(widthRatio, heightRatio) * 0.95; // 0.95 pour laisser des marges
				
				// Dimensions finales de l'image
				const finalWidth = imgWidth * ratio;
				const finalHeight = imgHeight * ratio;
				
				// Cr√©er un nouveau canvas aux dimensions de la page
				const pageCanvas = document.createElement('canvas');
				pageCanvas.width = pageWidth;
				pageCanvas.height = pageHeight;
				const ctx = pageCanvas.getContext('2d');
				
				// Fond blanc
				ctx.fillStyle = '#ffffff';
				ctx.fillRect(0, 0, pageWidth, pageHeight);
				
				// Centrer l'image sur la page
				const x = (pageWidth - finalWidth) / 2;
				const y = (pageHeight - finalHeight) / 2;
				
				// Dessiner l'image redimensionn√©e et centr√©e
				ctx.drawImage(canvas, x, y, finalWidth, finalHeight);
				
				// Convertir en image
				const imgData = pageCanvas.toDataURL("image/png");
				
				// Cr√©er la fen√™tre d'impression avec des styles optimis√©s
				const printWindow = window.open('', '_blank');
				
				// CSS d'impression optimis√© pour forcer une seule page
				const printStyles = `
					<style>
						@page {
							size: ${selectedFormat.includes('portrait') ? 'portrait' : 'landscape'};
							margin: 0;
						}
						
						@media print {
							* {
								margin: 0 !important;
								padding: 0 !important;
							}
							
							html, body {
								height: 100%;
								width: 100%;
								margin: 0;
								padding: 0;
								overflow: hidden;
							}
							
							.print-container {
								width: 100%;
								height: 100vh;
								display: flex;
								align-items: center;
								justify-content: center;
								page-break-after: avoid;
								page-break-inside: avoid;
							}
							
							img {
								max-width: 100%;
								max-height: 100vh;
								width: auto;
								height: auto;
								object-fit: contain;
							}
						}
						
						/* Styles pour l'aper√ßu √† l'√©cran */
						body {
							margin: 0;
							padding: 0;
							background: #f0f0f0;
							font-family: Arial, sans-serif;
						}
						
						.header {
							background: #333;
							color: white;
							padding: 15px;
							text-align: center;
							box-shadow: 0 2px 5px rgba(0,0,0,0.2);
						}
						
						.header h2 {
							margin: 0;
							font-size: 18px;
						}
						
						.header p {
							margin: 5px 0 0 0;
							font-size: 14px;
							opacity: 0.8;
						}
						
						.print-container {
							padding: 20px;
							text-align: center;
						}
						
						.print-preview {
							background: white;
							box-shadow: 0 0 20px rgba(0,0,0,0.1);
							display: inline-block;
							padding: 20px;
							margin: 20px auto;
						}
						
						img {
							max-width: 90vw;
							max-height: 80vh;
							width: auto;
							height: auto;
						}
						
						.print-button {
							background: #0056b3;
							color: white;
							border: none;
							padding: 12px 30px;
							font-size: 16px;
							border-radius: 5px;
							cursor: pointer;
							margin: 20px;
							transition: background 0.3s;
						}
						
						.print-button:hover {
							background: #003d82;
						}
						
						.format-info {
							background: #e9ecef;
							padding: 10px 20px;
							border-radius: 5px;
							display: inline-block;
							margin: 10px;
							font-size: 14px;
							color: #495057;
						}
					</style>
				`;
				
				// HTML de la fen√™tre d'impression
				printWindow.document.write(`
					<!DOCTYPE html>
					<html lang="fr">
					<head>
						<meta charset="UTF-8">
						<meta name="viewport" content="width=device-width, initial-scale=1.0">
						<title>Aper√ßu avant impression - ${format.name}</title>
						${printStyles}
					</head>
					<body>
						<div class="header">
							<h2>üìÑ Aper√ßu avant impression</h2>
							<p>Infographie Cybers√©curit√© - Format ${format.name}</p>
						</div>
						<div class="format-info">
							‚ÑπÔ∏è L'image sera automatiquement ajust√©e pour tenir sur une seule page ${format.name}
						</div>
						<div class="print-container">
							<div class="print-preview">
								<img src="${imgData}" alt="Infographie cybers√©curit√©" />
							</div>
						</div>
						<div style="text-align: center; padding-bottom: 30px;">
							<button class="print-button" onclick="window.print()">
								üñ®Ô∏è Lancer l'impression
							</button>
							<button class="print-button" style="background: #6c757d;" onclick="window.close()">
								‚ùå Fermer
							</button>
						</div>
					</body>
					</html>
				`);
				
				printWindow.document.close();
				showNotification('Aper√ßu d\'impression g√©n√©r√© avec succ√®s', 'success');
				
			}).catch(error => {
				console.error('Erreur lors de la capture:', error);
				showNotification('Erreur lors de la g√©n√©ration de l\'aper√ßu : ' + error.message, 'error');
			});
		}

		// Fonction am√©lior√©e avec pr√©visualisation de la mise en page
		function printWithPreview() {
			const formatSelect = document.getElementById("print-format");
			const selectedFormat = formatSelect.value;
			
			// Dimensions pour l'impression
			const formatSizes = {
				"A4-portrait": { width: 210, height: 297, cols: 1, name: "A4 Portrait" },
				"A4-landscape": { width: 297, height: 210, cols: 2, name: "A4 Paysage" },
				"A3-portrait": { width: 297, height: 420, cols: 2, name: "A3 Portrait" },
				"A3-landscape": { width: 420, height: 297, cols: 3, name: "A3 Paysage" }
			};
			
			const format = formatSizes[selectedFormat];
			
			// Cr√©er une fen√™tre de pr√©visualisation
			const previewWindow = window.open('', '_blank');
			
			// R√©cup√©rer toutes les donn√©es n√©cessaires
			const mainTitle = document.getElementById('main-title').value;
			const mainSubtitle = document.getElementById('main-subtitle').value;
			const emergencyMessage = document.getElementById('emergency-message').value;
			const footerMessage = document.getElementById('footer-message').value;
			
			// Couleurs
			const headerColor = document.getElementById('header-color').value;
			const timelineColor = document.getElementById('timeline-color').value;
			const stepNumberColor = document.getElementById('step-number-color').value;
			const footerColor = document.getElementById('footer-color').value;
			const emergencyColor = document.getElementById('emergency-color').value;
			const contentBgColor = document.getElementById('content-bg-color').value;
			const stepBgColor = document.getElementById('step-bg-color').value;
			
			// Logo
			const logoSrc = logoData.url || logoData.file;
			const logoHtml = logoSrc && logoData.position ? 
				`<img src="${logoSrc}" class="logo ${logoData.position}" style="max-width: ${logoData.size}px;">` : '';
			
			// G√©n√©rer le HTML optimis√© pour l'impression
			const printHTML = `
				<!DOCTYPE html>
				<html lang="fr">
				<head>
					<meta charset="UTF-8">
					<title>Impression - ${mainTitle}</title>
					<style>
						@page {
							size: ${format.width}mm ${format.height}mm;
							margin: 10mm;
						}
						
						* {
							margin: 0;
							padding: 0;
							box-sizing: border-box;
						}
						
						body {
							font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
							color: #2c3e50;
							background: white;
							font-size: 14px;
							line-height: 1.5;
						}
						
						/* Header */
						.header {
							background: linear-gradient(135deg, ${headerColor}, ${adjustBrightness(headerColor, -20)});
							color: white;
							text-align: center;
							padding: 30px 20px;
							position: relative;
							margin-bottom: 20px;
						}
						
						.header h1 {
							font-size: 2.5em;
							font-weight: 900;
							margin-bottom: 10px;
							text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
						}
						
						.header p {
							font-size: 1.1em;
							opacity: 0.95;
						}
						
						.logo {
							position: absolute;
							max-height: 80px;
						}
						
						.logo.top-left { top: 20px; left: 20px; }
						.logo.top-right { top: 20px; right: 20px; }
						.logo.top-center { top: 20px; left: 50%; transform: translateX(-50%); }
						.logo.bottom-left { bottom: 20px; left: 20px; }
						.logo.bottom-right { bottom: 20px; right: 20px; }
						.logo.bottom-center { bottom: 20px; left: 50%; transform: translateX(-50%); }
						
						/* Timeline */
						.timeline {
							display: flex;
							justify-content: center;
							align-items: center;
							margin: 20px 0;
							flex-wrap: wrap;
						}
						
						.timeline-item {
							background: ${timelineColor};
							color: white;
							padding: 10px 20px;
							border-radius: 25px;
							margin: 5px;
							font-weight: 700;
						}
						
						.timeline-separator {
							color: ${timelineColor};
							padding: 5px;
							font-size: 1.2em;
						}
						
						/* Steps Grid - Layout optimis√© pour l'impression */
						.steps-grid {
							display: grid;
							grid-template-columns: repeat(${format.cols}, 1fr);
							gap: 30px 25px; /* Plus d'espace vertical */
							padding: 35px 20px 20px 20px; /* Plus de padding en haut */
							margin-bottom: 20px;
						}
						
						/* Conteneur wrapper pour chaque √©tape */
						.step-wrapper {
							position: relative;
							padding-top: 15px; /* Espace pour le num√©ro qui d√©borde */
						}
						
						.step {
							background: ${stepBgColor};
							border-radius: 15px;
							padding: 25px;
							padding-top: 40px; /* Espace pour le num√©ro */
							border-left: 6px solid;
							position: relative;
							page-break-inside: avoid;
							break-inside: avoid;
							overflow: visible;
							margin-top: 15px; /* Petite marge pour s'assurer que le num√©ro ne touche pas le bord */
						}
						
						.step.immediate { border-left-color: ${classificationsData.critical.color}; }
						.step.management { border-left-color: ${stepNumberColor}; }
						.step.communication { border-left-color: ${classificationsData.important.color}; }
						.step.continuity { border-left-color: ${classificationsData.success.color}; }
						
						.step-number {
							position: absolute;
							top: -8px; /* L√©g√®rement d√©cal√© mais pas trop */
							left: 20px; /* Retour √† gauche comme dans l'aper√ßu */
							background: ${stepNumberColor};
							color: white;
							width: 40px;
							height: 40px;
							border-radius: 50%;
							display: flex;
							align-items: center;
							justify-content: center;
							font-weight: 900;
							font-size: 1.2em;
							box-shadow: 0 2px 8px rgba(0,0,0,0.2);
							z-index: 10;
							border: 3px solid ${stepBgColor}; /* Bordure blanche pour √©viter la coupure visuelle */
						}
						
						.step-icon {
							font-size: 3em;
							margin-bottom: 15px;
							display: block;
						}
						
						.step h3 {
							font-size: 1.3em;
							margin-bottom: 15px;
							color: #2c3e50;
							font-weight: 800;
						}
						
						.action-item {
							padding: 12px;
							border-radius: 8px;
							margin: 10px 0;
							border-left: 4px solid;
							font-size: 0.9em;
						}
						
						.action-item.critical {
							border-left-color: ${classificationsData.critical.color};
							background: ${hexToRgba(classificationsData.critical.color, 0.1)};
						}
						
						.action-item.important {
							border-left-color: ${classificationsData.important.color};
							background: ${hexToRgba(classificationsData.important.color, 0.1)};
						}
						
						.action-item.info {
							border-left-color: ${classificationsData.info.color};
							background: ${hexToRgba(classificationsData.info.color, 0.1)};
						}
						
						.action-item.success {
							border-left-color: ${classificationsData.success.color};
							background: ${hexToRgba(classificationsData.success.color, 0.1)};
						}
						
						.action-item img {
							max-width: 100%;
							height: auto;
							margin: 10px 0;
							border-radius: 4px;
						}
						
						/* Alternative : Layout avec num√©ro int√©gr√© pour √©viter les coupures */
						.step::before {
							content: '';
							position: absolute;
							top: -10px;
							left: 0;
							right: 0;
							height: 20px;
							background: transparent;
						}
						.emergency-contact {
							background: ${emergencyColor};
							color: white;
							padding: 25px;
							border-radius: 10px;
							margin: 20px;
							text-align: center;
							font-size: 1.1em;
							font-weight: 700;
						}
						
						/* Footer */
						.footer {
							background: ${footerColor};
							color: white;
							text-align: center;
							padding: 30px 20px;
							position: relative;
						}
						
						.footer p {
							margin-bottom: 10px;
						}
						
						@media print {
							body {
								print-color-adjust: exact;
								-webkit-print-color-adjust: exact;
							}
							
							.no-print {
								display: none !important;
							}
						}
						
						/* Contr√¥les d'impression */
						.print-controls {
							text-align: center;
							padding: 20px;
							background: #f8f9fa;
							border-bottom: 2px solid #dee2e6;
						}
						
						.print-controls button {
							background: #0056b3;
							color: white;
							border: none;
							padding: 10px 25px;
							margin: 0 10px;
							border-radius: 5px;
							cursor: pointer;
							font-size: 16px;
						}
						
						.print-controls button:hover {
							background: #003d82;
						}
						
						.format-info {
							background: #e3f2fd;
							padding: 15px;
							margin: 20px;
							border-radius: 8px;
							text-align: center;
							border: 1px solid #1976d2;
						}
					</style>
				</head>
				<body>
					<div class="print-controls no-print">
						<h2>Aper√ßu d'impression - Format ${format.name}</h2>
						<div class="format-info">
							<strong>‚ÑπÔ∏è Mise en page optimis√©e :</strong> ${format.cols} colonne(s) pour les √©tapes
						</div>
						<button onclick="window.print()">üñ®Ô∏è Imprimer</button>
						<button onclick="window.close()" style="background: #6c757d;">‚ùå Fermer</button>
					</div>
					
					<div class="container">
						<div class="header">
							${logoData.position && logoData.position.startsWith('top') ? logoHtml : ''}
							<h1>${escapeHtml(mainTitle)}</h1>
							<p>${escapeHtml(mainSubtitle)}</p>
						</div>
						
						<div class="timeline">
							${timelineData.map(item => 
								item.type === 'item' 
									? `<div class="timeline-item">${escapeHtml(item.text)}</div>`
									: `<div class="timeline-separator">${escapeHtml(item.text)}</div>`
							).join('')}
						</div>
						
						<div class="steps-grid">
							${stepsData.map(step => `
								<div class="step ${step.category}">
									<div class="step-number">${step.number}</div>
									<div class="step-icon">${escapeHtml(step.icon)}</div>
									<h3>${escapeHtml(step.title)}</h3>
									<div class="step-content">
										${step.actions.map(action => {
											const imageSrc = action.image?.url || action.image?.file;
											const imageHtml = imageSrc ? 
												`<img src="${imageSrc}" style="max-width: ${action.image.width}px;">` : '';
											
											return `
												<div class="action-item ${action.type}">
													${action.image?.position === 'above' ? imageHtml : ''}
													${sanitizeHtml(action.text)}
													${action.image?.position === 'below' ? imageHtml : ''}
												</div>
											`;
										}).join('')}
									</div>
								</div>
							`).join('')}
						</div>
						
						<div class="emergency-contact">
							${escapeHtml(emergencyMessage)}
						</div>
						
						<div class="footer">
							${logoData.position && logoData.position.startsWith('bottom') ? logoHtml : ''}
							${footerMessage.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('')}
						</div>
					</div>
				</body>
				</html>
			`;
			
			previewWindow.document.write(printHTML);
			previewWindow.document.close();
			
			showNotification('Aper√ßu d\'impression g√©n√©r√© avec mise en page optimis√©e', 'success');
		}
		
		// Fonction d'impression optimis√©e pour tenir sur une seule page
		function printOnSinglePage() {
			const formatSelect = document.getElementById("print-format");
			const selectedFormat = formatSelect.value;
			
			// Dimensions pour l'impression
			const formatSizes = {
				"A4-portrait": { width: 210, height: 297, cols: 1, name: "A4 Portrait" },
				"A4-landscape": { width: 297, height: 210, cols: 2, name: "A4 Paysage" },
				"A3-portrait": { width: 297, height: 420, cols: 2, name: "A3 Portrait" },
				"A3-landscape": { width: 420, height: 297, cols: 3, name: "A3 Paysage" }
			};
			
			const format = formatSizes[selectedFormat];
			
			// Calculer les dimensions optimales en fonction du nombre d'√©tapes
			const stepCount = stepsData.length;
			const rowsNeeded = Math.ceil(stepCount / format.cols);
			
			// Ajuster la taille de police de base selon le nombre d'√©tapes
			const baseFontSize = Math.min(14, Math.max(10, 16 - (stepCount / 3)));
			
			// Cr√©er une fen√™tre de pr√©visualisation
			const previewWindow = window.open('', '_blank');
			
			// R√©cup√©rer toutes les donn√©es
			const mainTitle = document.getElementById('main-title').value;
			const mainSubtitle = document.getElementById('main-subtitle').value;
			const emergencyMessage = document.getElementById('emergency-message').value;
			const footerMessage = document.getElementById('footer-message').value;
			
			// Couleurs
			const headerColor = document.getElementById('header-color').value;
			const timelineColor = document.getElementById('timeline-color').value;
			const stepNumberColor = document.getElementById('step-number-color').value;
			const footerColor = document.getElementById('footer-color').value;
			const emergencyColor = document.getElementById('emergency-color').value;
			const contentBgColor = document.getElementById('content-bg-color').value;
			const stepBgColor = document.getElementById('step-bg-color').value;
			
			// Logo
			const logoSrc = logoData.url || logoData.file;
			const logoHtml = logoSrc && logoData.position ? 
				`<img src="${logoSrc}" class="logo ${logoData.position}" style="max-width: ${Math.min(logoData.size, 80)}px;">` : '';
			
			// G√©n√©rer le HTML optimis√© pour une seule page
			const printHTML = `
				<!DOCTYPE html>
				<html lang="fr">
				<head>
					<meta charset="UTF-8">
					<title>Impression - ${mainTitle}</title>
					<style>
						@page {
							size: ${format.width}mm ${format.height}mm;
							margin: 10mm;
						}
						
						* {
							margin: 0;
							padding: 0;
							box-sizing: border-box;
						}
						
						body {
							font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
							color: #2c3e50;
							background: white;
							font-size: ${baseFontSize}px;
							line-height: 1.4;
							height: 100vh;
							overflow: hidden;
						}
						
						/* Conteneur principal qui prend toute la page */
						.page-container {
							width: 100%;
							height: 100vh;
							display: flex;
							flex-direction: column;
							page-break-after: avoid;
							page-break-inside: avoid;
							padding: 0;
							margin: 0;
						}
						
						/* Header - R√©duit */
						.header {
							background: linear-gradient(135deg, ${headerColor}, ${adjustBrightness(headerColor, -20)});
							color: white;
							text-align: center;
							padding: 10px;
							position: relative;
							flex-shrink: 0;
						}
						
						.header h1 {
							font-size: ${Math.min(2.2, Math.max(1.5, 2.5 - (stepCount / 10)))}em;
							font-weight: 900;
							margin-bottom: 3px;
							text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
						}
						
						.header p {
							font-size: 0.85em;
							opacity: 0.95;
							margin: 0;
						}
						
						.logo {
							position: absolute;
							max-height: 50px;
						}
						
						.logo.top-left { top: 10px; left: 10px; }
						.logo.top-right { top: 10px; right: 10px; }
						.logo.top-center { top: 10px; left: 50%; transform: translateX(-50%); }
						.logo.bottom-left { bottom: 10px; left: 10px; }
						.logo.bottom-right { bottom: 10px; right: 10px; }
						.logo.bottom-center { bottom: 10px; left: 50%; transform: translateX(-50%); }
						
						/* Timeline - Compacte */
						.timeline {
							display: flex;
							justify-content: center;
							align-items: center;
							padding: 5px;
							flex-shrink: 0;
							flex-wrap: wrap;
							gap: 3px;
						}
						
						.timeline-item {
							background: ${timelineColor};
							color: white;
							padding: 3px 10px;
							border-radius: 15px;
							font-weight: 700;
							font-size: 0.75em;
						}
						
						.timeline-separator {
							color: ${timelineColor};
							padding: 0 3px;
							font-size: 0.9em;
						}
						
						/* Steps Grid - Flexible pour remplir l'espace disponible */
						.steps-grid {
							display: grid;
							grid-template-columns: repeat(${format.cols}, 1fr);
							gap: 15px 10px;
							padding: 20px 15px 15px 15px; /* Plus de padding en haut pour les num√©ros */
							flex: 1;
							overflow: hidden;
							align-content: stretch; /* √âtirer le contenu */
							align-items: stretch; /* √âtirer les items */
						}
						
						.step {
							background: ${stepBgColor};
							border-radius: 10px;
							padding: 12px;
							padding-top: 30px; /* Espace suffisant pour le num√©ro */
							border-left: 4px solid;
							position: relative;
							display: flex;
							flex-direction: column;
							min-height: 0; /* Important pour flexbox */
						}
						
						.step.immediate { border-left-color: ${classificationsData.critical.color}; }
						.step.management { border-left-color: ${stepNumberColor}; }
						.step.communication { border-left-color: ${classificationsData.important.color}; }
						.step.continuity { border-left-color: ${classificationsData.success.color}; }
						
						.step-number {
							position: absolute;
							top: 5px; /* Position √† l'int√©rieur pour √©viter la coupure */
							left: 10px;
							background: ${stepNumberColor};
							color: white;
							width: 35px;
							height: 35px;
							border-radius: 50%;
							display: flex;
							align-items: center;
							justify-content: center;
							font-weight: 900;
							font-size: 1em;
							z-index: 10;
							box-shadow: 0 2px 4px rgba(0,0,0,0.2);
						}
						
						.step-icon {
							font-size: ${Math.max(1.8, 2.8 - (stepCount / 8))}em;
							margin-bottom: 5px;
							display: block;
							flex-shrink: 0;
						}
						
						.step h3 {
							font-size: 1.15em;
							margin-bottom: 8px;
							color: #2c3e50;
							font-weight: 800;
							line-height: 1.1;
							flex-shrink: 0;
						}
						
						.step-content {
							flex: 1;
							overflow-y: auto;
							overflow-x: hidden;
							font-size: 0.9em;
						}
						
						/* Scrollbar personnalis√©e pour le contenu */
						.step-content::-webkit-scrollbar {
							width: 3px;
						}
						
						.step-content::-webkit-scrollbar-track {
							background: rgba(0,0,0,0.1);
							border-radius: 3px;
						}
						
						.step-content::-webkit-scrollbar-thumb {
							background: rgba(0,0,0,0.3);
							border-radius: 3px;
						}
						
						.action-item {
							padding: 6px 8px;
							border-radius: 5px;
							margin: 4px 0;
							border-left: 3px solid;
							font-size: 0.9em;
							line-height: 1.3;
						}
						
						.action-item.critical {
							border-left-color: ${classificationsData.critical.color};
							background: ${hexToRgba(classificationsData.critical.color, 0.1)};
						}
						
						.action-item.important {
							border-left-color: ${classificationsData.important.color};
							background: ${hexToRgba(classificationsData.important.color, 0.1)};
						}
						
						.action-item.info {
							border-left-color: ${classificationsData.info.color};
							background: ${hexToRgba(classificationsData.info.color, 0.1)};
						}
						
						.action-item.success {
							border-left-color: ${classificationsData.success.color};
							background: ${hexToRgba(classificationsData.success.color, 0.1)};
						}
						
						.action-item img {
							max-width: 100%;
							max-height: 80px;
							height: auto;
							margin: 5px 0;
							border-radius: 3px;
							display: block;
						}
						
						/* Emergency - Compact */
						.emergency-contact {
							background: ${emergencyColor};
							color: white;
							padding: 8px;
							margin: 5px 10px;
							text-align: center;
							font-size: 0.85em;
							font-weight: 700;
							border-radius: 6px;
							flex-shrink: 0;
							line-height: 1.3;
						}
						
						/* Footer - Compact */
						.footer {
							background: ${footerColor};
							color: white;
							text-align: center;
							padding: 8px;
							position: relative;
							flex-shrink: 0;
						}
						
						.footer p {
							margin: 2px 0;
							font-size: 0.75em;
							line-height: 1.3;
						}
						
						@media print {
							body {
								print-color-adjust: exact;
								-webkit-print-color-adjust: exact;
							}
							
							.no-print {
								display: none !important;
							}
							
							.page-container {
								height: 100vh !important;
							}
						}
						
						/* Contr√¥les d'impression */
						.print-controls {
							text-align: center;
							padding: 20px;
							background: #f8f9fa;
							border-bottom: 2px solid #dee2e6;
						}
						
						.print-controls button {
							background: #0056b3;
							color: white;
							border: none;
							padding: 10px 25px;
							margin: 0 10px;
							border-radius: 5px;
							cursor: pointer;
							font-size: 16px;
						}
						
						.print-controls button:hover {
							background: #003d82;
						}
						
						.format-info {
							background: #fff3cd;
							padding: 15px;
							margin: 20px;
							border-radius: 8px;
							text-align: center;
							border: 1px solid #ffeaa7;
							color: #856404;
						}
						
						/* Ajustements pour tr√®s nombreuses √©tapes */
						${stepCount > 8 ? `
							.step { padding: 10px 8px; padding-top: 20px; }
							.step-icon { font-size: 1.5em; margin-bottom: 5px; }
							.step h3 { font-size: 1em; margin-bottom: 5px; }
							.action-item { padding: 4px 6px; margin: 2px 0; font-size: 0.8em; }
							.step-content { font-size: 0.8em; }
						` : ''}
						
						${stepCount > 12 ? `
							.header h1 { font-size: 1.8em; }
							.header p { font-size: 0.8em; }
							.timeline-item { font-size: 0.7em; padding: 3px 8px; }
							.emergency-contact { padding: 10px; font-size: 0.8em; }
							.footer p { font-size: 0.75em; }
						` : ''}
					</style>
				</head>
				<body>
					<div class="print-controls no-print">
						<h2>üñ®Ô∏è Aper√ßu d'impression - Une seule page</h2>
						<div class="format-info">
							<strong>‚ö†Ô∏è Mode affiche :</strong> Tout le contenu sera ajust√© pour tenir sur une seule page ${format.name}<br>
							<small>${stepCount} √©tapes r√©parties sur ${rowsNeeded} ligne(s) √ó ${format.cols} colonne(s)</small>
						</div>
						<button onclick="window.print()">üñ®Ô∏è Imprimer l'affiche</button>
						<button onclick="window.close()" style="background: #6c757d;">‚ùå Fermer</button>
					</div>
					
					<div class="page-container">
						<div class="header">
							${logoData.position && logoData.position.startsWith('top') ? logoHtml : ''}
							<h1>${escapeHtml(mainTitle)}</h1>
							<p>${escapeHtml(mainSubtitle)}</p>
						</div>
						
						<div class="timeline">
							${timelineData.map(item => 
								item.type === 'item' 
									? `<div class="timeline-item">${escapeHtml(item.text)}</div>`
									: `<div class="timeline-separator">${escapeHtml(item.text)}</div>`
							).join('')}
						</div>
						
						<div class="steps-grid">
							${stepsData.map(step => `
								<div class="step ${step.category}">
									<div class="step-number">${step.number}</div>
									<div class="step-icon">${escapeHtml(step.icon)}</div>
									<h3>${escapeHtml(step.title)}</h3>
									<div class="step-content">
										${step.actions.map(action => {
											const imageSrc = action.image?.url || action.image?.file;
											const imageHtml = imageSrc ? 
												`<img src="${imageSrc}" alt="Image">` : '';
											
											return `
												<div class="action-item ${action.type}">
													${action.image?.position === 'above' ? imageHtml : ''}
													${sanitizeHtml(action.text)}
													${action.image?.position === 'below' ? imageHtml : ''}
												</div>
											`;
										}).join('')}
									</div>
								</div>
							`).join('')}
						</div>
						
						<div class="emergency-contact">
							${escapeHtml(emergencyMessage)}
						</div>
						
						<div class="footer">
							${logoData.position && logoData.position.startsWith('bottom') ? logoHtml : ''}
							${footerMessage.split('\n').map(line => `<p>${escapeHtml(line)}</p>`).join('')}
						</div>
					</div>
				</body>
				</html>
			`;
			
			previewWindow.document.write(printHTML);
			previewWindow.document.close();
			
			showNotification('Aper√ßu d\'impression g√©n√©r√© - Mode affiche une page', 'success');
		}
       /**
        * ========================================
        * FIN DU G√âN√âRATEUR COMPLET
        * ========================================
        * 
        * üéØ Fonctionnalit√©s compl√®tes impl√©ment√©es:
        * ‚úÖ Interface compl√®te avec FAQ d√©taill√©es
        * ‚úÖ Personnalisation avanc√©e des couleurs et arri√®re-plans
        * ‚úÖ Gestion compl√®te des logos (drag&drop, URL, positions)
        * ‚úÖ Classifications d'actions personnalisables
        * ‚úÖ Timeline interactive avec s√©parateurs
        * ‚úÖ √âditeur d'√©tapes avec formatage de texte
        * ‚úÖ S√©lecteur d'ic√¥nes avec 70+ options
        * ‚úÖ Th√®mes pr√©d√©finis
        * ‚úÖ Sauvegarde/chargement de projets
        * ‚úÖ Export HTML autonome optimis√©
        * ‚úÖ Interface responsive et accessible
        * ‚úÖ Tooltips et aide contextuelle
        * ‚úÖ Notifications utilisateur
        * ‚úÖ Raccourcis clavier
        * ‚úÖ Licence open source clairement d√©finie
        * 
        * Version: 2.0 - Code complet et fonctionnel
        * Libre pour usage public et personnel
        * Licence commerciale requise pour entreprises priv√©es
        */
   </script>
</body>
</html>